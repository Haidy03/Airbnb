<div class="modal-card">
  <!-- Header -->
  <div class="modal-header">
    <button 
      *ngIf="showBackButton" 
      class="back-button" 
      (click)="onBack()"
      type="button">
      <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 28 8.7 16.7a1 1 0 0 1 0-1.4L20 4"></path>
      </svg>
    </button>
    <h2>{{ modalTitle }}</h2>
    <button class="close-button" (click)="closeModal()" type="button">
      <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <path d="m6 6 20 20M26 6 6 26"></path>
      </svg>
    </button>
  </div>

  <div class="divider"></div>

  <!-- Body -->
  <div class="modal-body">
    <!-- ============== PHONE LOGIN - INPUT && isPhoneInput ============== -->
     <div *ngIf="isPhoneMode && isPhoneInput">
  <h1 class="welcome-title">Welcome to Airbnb</h1>
  
  <form [formGroup]="phoneForm" (ngSubmit)="onPhoneContinue()">
    <!-- Country Code Select -->
    <div class="country-select-wrapper">
      <div class="country-select" (click)="toggleCountryDropdown()">
        <div class="select-content">
          <label class="select-label">Country code</label>
          <div class="selected-country">
            {{ selectedCountry().name }} ({{ selectedCountry().dialCode }})
          </div>
        </div>
        <svg 
          class="chevron-icon"
          [class.open]="isCountryDropdownOpen()"
          viewBox="0 0 32 32" 
          xmlns="http://www.w3.org/2000/svg">
          <path d="m4 12 11.3 11.3a1 1 0 0 0 1.4 0L28 12"></path>
        </svg>
      </div>

      <!-- Dropdown -->
      <div class="dropdown" *ngIf="isCountryDropdownOpen()">
        <div class="dropdown-list">
          <div 
            *ngFor="let country of countries"
            class="dropdown-item"
            [class.selected]="country.code === selectedCountry().code"
            (click)="selectCountry(country)">
            <span class="country-flag">{{ country.flag }}</span>
            <span class="country-name">{{ country.name }}</span>
            <span class="country-dial">{{ country.dialCode }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Phone Number Input -->
    <div class="input-group">
      <input
        type="tel"
        formControlName="phoneNumber"
        placeholder="Phone number"
        class="phone-input"
        [class.error]="phoneNumber?.invalid && phoneNumber?.touched"
      />
    </div>

    <!-- Specific Error Feedback -->
    <small class="error-text" *ngIf="phoneNumber?.hasError('pattern') && phoneNumber?.touched">
      <span *ngIf="selectedCountry().code === 'EG'">
        Must be 10 digits.
      </span>
      <span *ngIf="selectedCountry().code !== 'EG'">
        Invalid phone number format for {{ selectedCountry().name }}
      </span>
    </small>

    <!-- Password Input -->
    <div class="form-group">
      <div class="password-wrapper">
        <input
          id="phonePassword"
          [type]="showPassword() ? 'text' : 'password'"
          formControlName="password"
          placeholder="Password"
          class="form-input"
          [class.error]="phonePassword?.invalid && phonePassword?.touched"
        />
          <button type="button" class="password-toggle" (click)="togglePasswordVisibility()">
          <svg *ngIf="showPassword()" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor">
            <path d="M16 23.334a12.72 12.72 0 0 1-9.927-4.684l-.105-.133-.106-.134.106-.133A12.72 12.72 0 0 1 16 13.55a12.72 12.72 0 0 1 9.927 4.684l.105.133.106.134-.106.133A12.72 12.72 0 0 1 16 23.334zM6.55 18.417A10.72 10.72 0 0 0 16 21.334a10.72 10.72 0 0 0 9.45-2.917A10.72 10.72 0 0 0 16 15.55a10.72 10.72 0 0 0-9.45 2.867zM16 20.667a2.25 2.25 0 1 1 0-4.5 2.25 2.25 0 0 1 0 4.5z"></path>
            <circle cx="16" cy="18.417" r="1.25"></circle>
          </svg>
          <svg *ngIf="!showPassword()" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor">
            <path d="M26.667 2.667 3.334 26l1.883 1.883L28.55 4.55z"></path>
            <path d="M22.25 12.167a12.72 12.72 0 0 1 3.683 6.166l.106.134-.106.133A12.72 12.72 0 0 1 16 23.333a12.63 12.63 0 0 1-5.467-1.216l1.6-1.6a10.7 10.7 0 0 0 3.867.716 10.72 10.72 0 0 0 9.45-2.916 10.66 10.66 0 0 0-2.65-4.5zM12.967 20.467 9.4 24.033a16.6 16.6 0 0 1-3.333-5.45l-.106-.133.106-.133a12.72 12.72 0 0 1 9.75-4.734c.833 0 1.633.1 2.4.284l-1.567 1.566a10.7 10.7 0 0 0-.833-.033 10.72 10.72 0 0 0-9.45 2.866 10.67 10.67 0 0 0 2.233 4.017l1.734-1.734a2.25 2.25 0 0 1 2.633-1.783z"></path>
          </svg>
        </button>
      </div>
      <small class="error-text" *ngIf="phonePassword?.invalid && phonePassword?.touched">
        Password is required
      </small>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage()">
      {{ errorMessage() }}
    </div>

    <!-- Continue Button -->
    <button 
      type="submit" 
      class="btn-continue" 
      [disabled]="phoneForm.invalid || isLoading()">
      <span *ngIf="!isLoading()">Continue</span>
      <span *ngIf="isLoading()" class="spinner"></span>
    </button>
  </form>

  <!-- Divider -->
  <div class="divider-text">
    <span>or</span>
  </div>

  <!-- Social Buttons -->
  <app-social-buttons (socialLogin)="onSocialLogin($event)"></app-social-buttons>

  <!-- Register Link -->
  <div class="bottom-link">
    Don't have an account? 
    <button class="link-button" (click)="switchMode('register')">Sign up</button>
  </div>
</div>
    <!-- ============== EMAIL LOGIN ============== -->
    <div *ngIf="isEmailMode">
      <form [formGroup]="emailLoginForm" (ngSubmit)="onEmailLogin()">
        <div class="form-group">
          <label for="email">Email</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            placeholder="Email"
            class="form-input"
            [class.error]="email?.invalid && email?.touched"
          />
          <small class="error-text" *ngIf="email?.invalid && email?.touched">
            Please enter a valid email
          </small>
        </div>
       
        <div class="form-group">
          <label for="password">Password</label>
          <div class="password-wrapper">
            <input
              id="password"
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="password"
              placeholder="Password"
              class="form-input"
              [class.error]="emailPassword?.invalid && emailPassword?.touched"
            />
           <button type="button" class="password-toggle" (click)="togglePasswordVisibility()">
              <svg *ngIf="showPassword()" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor">
                <path d="M16 23.334a12.72 12.72 0 0 1-9.927-4.684l-.105-.133-.106-.134.106-.133A12.72 12.72 0 0 1 16 13.55a12.72 12.72 0 0 1 9.927 4.684l.105.133.106.134-.106.133A12.72 12.72 0 0 1 16 23.334zM6.55 18.417A10.72 10.72 0 0 0 16 21.334a10.72 10.72 0 0 0 9.45-2.917A10.72 10.72 0 0 0 16 15.55a10.72 10.72 0 0 0-9.45 2.867zM16 20.667a2.25 2.25 0 1 1 0-4.5 2.25 2.25 0 0 1 0 4.5z"></path>
                <circle cx="16" cy="18.417" r="1.25"></circle>
              </svg>
              <svg *ngIf="!showPassword()" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor">
                <path d="M26.667 2.667 3.334 26l1.883 1.883L28.55 4.55z"></path>
                <path d="M22.25 12.167a12.72 12.72 0 0 1 3.683 6.166l.106.134-.106.133A12.72 12.72 0 0 1 16 23.333a12.63 12.63 0 0 1-5.467-1.216l1.6-1.6a10.7 10.7 0 0 0 3.867.716 10.72 10.72 0 0 0 9.45-2.916 10.66 10.66 0 0 0-2.65-4.5zM12.967 20.467 9.4 24.033a16.6 16.6 0 0 1-3.333-5.45l-.106-.133.106-.133a12.72 12.72 0 0 1 9.75-4.734c.833 0 1.633.1 2.4.284l-1.567 1.566a10.7 10.7 0 0 0-.833-.033 10.72 10.72 0 0 0-9.45 2.866 10.67 10.67 0 0 0 2.233 4.017l1.734-1.734a2.25 2.25 0 0 1 2.633-1.783z"></path>
              </svg>
            </button>
          </div>
          <small class="error-text" *ngIf="emailPassword?.invalid && emailPassword?.touched">
            Password is required
          </small>
        </div>

        <!-- Error Message -->
        <div class="error-message" *ngIf="errorMessage()">
          {{ errorMessage() }}
        </div>

        <!-- Submit Button -->
        <button 
          type="submit" 
          class="btn-continue" 
          [disabled]="emailLoginForm.invalid || isLoading()">
          <span *ngIf="!isLoading()">Continue</span>
          <span *ngIf="isLoading()" class="spinner"></span>
        </button>
      </form>

      <div class="forgot-password-link" *ngIf="isEmailMode">
        <a href="#" (click)="openForgotPassword($event)">Forgot password?</a>
      </div>

      <!-- Register Link -->
      <div class="bottom-link">
        Don't have an account? 
        <button class="link-button" (click)="switchMode('register')">Sign up</button>
      </div>
    </div>

    <!-- ============== REGISTER ============== -->
    <div *ngIf="isRegisterMode">
      <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">First name</label>
            <input
              id="firstName"
              type="text"
              formControlName="firstName"
              placeholder="First name"
              class="form-input"
              [class.error]="firstName?.invalid && firstName?.touched"
            />
            <small class="error-text" *ngIf="firstName?.invalid && firstName?.touched">
              First name is required
            </small>
          </div>

          <div class="form-group">
            <label for="lastName">Last name</label>
            <input
              id="lastName"
              type="text"
              formControlName="lastName"
              placeholder="Last name"
              class="form-input"
              [class.error]="lastName?.invalid && lastName?.touched"
            />
            <small class="error-text" *ngIf="lastName?.invalid && lastName?.touched">
              Last name is required
            </small>
          </div>
        </div>

        <div class="form-group">
          <label for="registerEmail">Email</label>
          <input
            id="registerEmail"
            type="email"
            formControlName="email"
            placeholder="Email"
            class="form-input"
            [class.error]="registerEmail?.invalid && registerEmail?.touched"
          />
          <small class="error-text" *ngIf="registerEmail?.invalid && registerEmail?.touched">
            Please enter a valid email
          </small>
        </div>
         
       <div class="form-group">
      <label for="registerPhone">Phone Number</label>
      <div class="phone-input-group">
        <select formControlName="countryCode" class="country-code-select">
          <option *ngFor="let country of countries" [value]="country.dialCode">
            {{ country.flag }} {{ country.dialCode }}
          </option>
        </select>
        <input
          id="registerPhone"
          type="tel"
          formControlName="phoneNumber"
          placeholder="Phone number"
          class="form-input phone-number-input"
          [class.error]="registerPhone?.invalid && registerPhone?.touched"
        />
      </div>
      <small class="error-text" *ngIf="registerPhone?.invalid && registerPhone?.touched">
        Please enter a valid phone number
      </small>
    </div>

        <div class="form-group">
          <label for="registerPassword">Password</label>
          <div class="password-wrapper">
            <input
              id="registerPassword"
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="password"
              placeholder="Password"
              class="form-input"
              [class.error]="registerPassword?.invalid && registerPassword?.touched"
            />
            <button type="button" class="password-toggle" (click)="togglePasswordVisibility()">
              <svg *ngIf="showPassword()" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor">
                <path d="M16 23.334a12.72 12.72 0 0 1-9.927-4.684l-.105-.133-.106-.134.106-.133A12.72 12.72 0 0 1 16 13.55a12.72 12.72 0 0 1 9.927 4.684l.105.133.106.134-.106.133A12.72 12.72 0 0 1 16 23.334zM6.55 18.417A10.72 10.72 0 0 0 16 21.334a10.72 10.72 0 0 0 9.45-2.917A10.72 10.72 0 0 0 16 15.55a10.72 10.72 0 0 0-9.45 2.867zM16 20.667a2.25 2.25 0 1 1 0-4.5 2.25 2.25 0 0 1 0 4.5z"></path>
                <circle cx="16" cy="18.417" r="1.25"></circle>
              </svg>
              <svg *ngIf="!showPassword()" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor">
                <path d="M26.667 2.667 3.334 26l1.883 1.883L28.55 4.55z"></path>
                <path d="M22.25 12.167a12.72 12.72 0 0 1 3.683 6.166l.106.134-.106.133A12.72 12.72 0 0 1 16 23.333a12.63 12.63 0 0 1-5.467-1.216l1.6-1.6a10.7 10.7 0 0 0 3.867.716 10.72 10.72 0 0 0 9.45-2.916 10.66 10.66 0 0 0-2.65-4.5zM12.967 20.467 9.4 24.033a16.6 16.6 0 0 1-3.333-5.45l-.106-.133.106-.133a12.72 12.72 0 0 1 9.75-4.734c.833 0 1.633.1 2.4.284l-1.567 1.566a10.7 10.7 0 0 0-.833-.033 10.72 10.72 0 0 0-9.45 2.866 10.67 10.67 0 0 0 2.233 4.017l1.734-1.734a2.25 2.25 0 0 1 2.633-1.783z"></path>
              </svg>
            </button>
          </div>
          <small class="error-text" *ngIf="registerPassword?.invalid && registerPassword?.touched">
            Password must be at least 8 characters
          </small>
          <small class="help-text">Use 8 or more characters with a mix of letters, numbers & symbols</small>
        </div>

        <!-- Error Message -->
        <div class="error-message" *ngIf="errorMessage()">
          {{ errorMessage() }}
        </div>

        <!-- Terms -->
        <p class="terms-text">
          By selecting <strong>Agree and continue</strong>, I agree to Airbnb's 
          <a href="#">Terms of Service</a>, 
          <a href="#">Payments Terms of Service</a>, and 
          <a href="#">Nondiscrimination Policy</a> and acknowledge the 
          <a href="#">Privacy Policy</a>.
        </p>

        <!-- Submit Button -->
        <button 
          type="submit" 
          class="btn-continue" 
          [disabled]="registerForm.invalid || isLoading()" >
          <span *ngIf="!isLoading()">Agree and continue </span>   
          <span *ngIf="isLoading()" class="spinner"></span>
        </button>
      </form>

      <!-- Login Link -->
      <div class="bottom-link">
        Already have an account? 
        <button class="link-button" (click)="switchMode('phone')">Log in</button>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop for country dropdown -->
<div class="backdrop" *ngIf="isCountryDropdownOpen()" (click)="toggleCountryDropdown()"></div>
