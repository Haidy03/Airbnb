<div class="admin-verifications">
  <div class="page-header">
    <div>
      <h1>ID Verifications</h1>
      <p class="subtitle">Review and approve user identity verifications</p>
    </div>
  </div>

  <!-- Status Filters -->
  <div class="filters-section">
    <button 
      class="filter-tab"
      [class.active]="selectedStatus() === 'Pending'"
      (click)="onStatusChange('Pending')">
      Pending
    </button>
    <button 
      class="filter-tab"
      [class.active]="selectedStatus() === 'Approved'"
      (click)="onStatusChange('Approved')">
      Approved
    </button>
    <button 
      class="filter-tab"
      [class.active]="selectedStatus() === 'Rejected'"
      (click)="onStatusChange('Rejected')">
      Rejected
    </button>
    <button 
      class="filter-tab"
      [class.active]="selectedStatus() === 'All'"
      (click)="onStatusChange('All')">
      All
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
    <p>Loading verifications...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error()" class="error-state">
    <p>{{ error() }}</p>
    <button class="retry-btn" (click)="loadVerifications()">Retry</button>
  </div>

  <!-- Verifications Grid -->
  <div *ngIf="!loading() && !error()" class="verifications-grid">
    <div *ngFor="let verification of verifications()" class="verification-card">
      <!-- Status Badge -->
      <div class="card-status" [ngClass]="getStatusBadgeClass(verification.status)">
        {{ verification.status }}
      </div>

      <!-- User Info -->
      <div class="user-section">
        <div class="user-avatar">
          {{ verification.userName.split(' ')[0].charAt(0) }}{{ verification.userName.split(' ')[1]?.charAt(0) || '' }}
        </div>
        <div class="user-info">
          <h3>{{ verification.userName }}</h3>
          <p>{{ verification.userEmail }}</p>
        </div>
      </div>

      <!-- ID Details -->
      <div class="id-details">
        <div class="detail-row">
          <span class="label">ID Type:</span>
          <span class="value">{{ verification.idType }}</span>
        </div>
        <div class="detail-row">
          <span class="label">ID Number:</span>
          <span class="value">{{ verification.idNumber }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Submitted:</span>
          <span class="value">{{ formatDate(verification.submittedAt) }}</span>
        </div>
      </div>

      <!-- ID Image Preview -->
      <div class="image-preview" (click)="openImageModal(verification)">
        <img [src]="verification.idImageUrl" alt="ID Document">
        <div class="image-overlay">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" stroke="currentColor" stroke-width="2"/>
          </svg>
          <span>View Full Image</span>
        </div>
      </div>

      <!-- Admin Notes -->
      <div *ngIf="verification.adminNotes" class="admin-notes">
        <strong>Admin Notes:</strong>
        <p>{{ verification.adminNotes }}</p>
      </div>

      <!-- Actions -->
      <div class="card-actions" *ngIf="verification.status === 'Pending'">
        <button class="btn btn-approve" (click)="openApproveModal(verification)">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2"/>
            <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2"/>
          </svg>
          Approve
        </button>
        <button class="btn btn-reject" (click)="openRejectModal(verification)">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
            <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
          </svg>
          Reject
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="verifications().length === 0" class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2"/>
        <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2"/>
      </svg>
      <h3>No verifications found</h3>
      <p>There are no {{ selectedStatus().toLowerCase() }} verification requests</p>
    </div>
  </div>

  <!-- Image Modal -->
  <div class="modal-overlay" *ngIf="showImageModal()" (click)="closeImageModal()">
    <div class="modal-content image-modal" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeImageModal()">×</button>
      <img [src]="selectedVerification()?.idImageUrl" alt="ID Document Full View">
    </div>
  </div>

  <!-- Approve Modal -->
  <div class="modal-overlay" *ngIf="showApproveModal()" (click)="closeApproveModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Approve Verification</h2>
        <button class="close-btn" (click)="closeApproveModal()">×</button>
      </div>
      <div class="modal-body">
        <p>
          You are approving the ID verification for 
          <strong>{{ selectedVerification()?.userName }}</strong>
        </p>
        <label>Admin Notes (Optional):</label>
        <textarea 
          class="modal-textarea"
          placeholder="Add any notes about this verification..."
          [(ngModel)]="adminNotes"
          rows="3">
        </textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>
        <button class="btn btn-success" (click)="approveVerification()">Approve Verification</button>
      </div>
    </div>
  </div>

  <!-- Reject Modal -->
  <div class="modal-overlay" *ngIf="showRejectModal()" (click)="closeRejectModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Reject Verification</h2>
        <button class="close-btn" (click)="closeRejectModal()">×</button>
      </div>
      <div class="modal-body">
        <p>
          You are rejecting the ID verification for 
          <strong>{{ selectedVerification()?.userName }}</strong>
        </p>
        <label>Rejection Reason (Required):</label>
        <textarea 
          class="modal-textarea"
          placeholder="Provide a clear reason for rejection..."
          [(ngModel)]="rejectionReason"
          rows="3">
        </textarea>
        <label>Admin Notes (Optional):</label>
        <textarea 
          class="modal-textarea"
          placeholder="Additional internal notes..."
          [(ngModel)]="adminNotes"
          rows="2">
        </textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeRejectModal()">Cancel</button>
        <button class="btn btn-danger" (click)="rejectVerification()">Reject Verification</button>
      </div>
    </div>
  </div>
</div>