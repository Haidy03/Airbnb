<div class="admin-analytics">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1>Analytics & Reports</h1>
      <p class="subtitle">View detailed insights and platform statistics</p>
    </div>
    <div class="header-actions">
    </div>
  </div>

  <!-- Date Filter -->
  <div class="filters-section">
    <div class="date-filters">
      <div class="date-input-group">
        <label>From:</label>
        <input 
          type="date" 
          [(ngModel)]="startDate"
          class="date-input"
        />
      </div>
      <div class="date-input-group">
        <label>To:</label>
        <input 
          type="date" 
          [(ngModel)]="endDate"
          class="date-input"
        />
      </div>
      <button class="filter-btn" (click)="applyDateFilter()">Apply Filter</button>
    </div>

    <!-- Report Tabs -->
    <div class="report-tabs">
      <button 
        class="report-tab"
        [class.active]="selectedReport() === 'revenue'"
        (click)="selectReport('revenue')">
        Revenue Report
      </button>
      <button 
        class="report-tab"
        [class.active]="selectedReport() === 'activity'"
        (click)="selectReport('activity')">
        User Activity
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
    <p>Loading analytics...</p>
  </div>

  <!-- Revenue Report -->
  <div *ngIf="!loading() && selectedReport() === 'revenue' && revenueReport()" class="report-section">
    <div class="report-header">
      <h2>Revenue Report</h2>
      <p class="report-period">{{ revenueReport()?.period }}</p>
    </div>

    <!-- Revenue Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="card-icon revenue">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <line x1="12" y1="1" x2="12" y2="23" stroke="currentColor" stroke-width="2"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="card-content">
          <p class="card-label">Total Revenue</p>
          <p class="card-value"><span>EGP</span>{{ revenueReport()!.totalRevenue }}</p>
        </div>
      </div>

      <div class="summary-card">
        <div class="card-icon platform">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
            <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="card-content">
          <p class="card-label">Platform Fees (15%)</p>
          <p class="card-value"><span>EGP</span>{{ revenueReport()!.platformFees }}</p>
        </div>
      </div>

      <div class="summary-card">
        <div class="card-icon host">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="card-content">
          <p class="card-label">Host Payouts</p>
          <p class="card-value"><span>EGP</span>{{ revenueReport()!.hostPayouts }}</p>
        </div>
      </div>

      <div class="summary-card">
        <div class="card-icon bookings">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
            <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
            <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="card-content">
          <p class="card-label">Total Bookings</p>
          <p class="card-value">{{ revenueReport()!.totalBookings }}</p>
          <p class="card-sublabel">Avg: <span>EGP</span>{{ revenueReport()!.averageBookingValue }}</p>
        </div>
      </div>
    </div>

    <!-- Revenue by Location -->
    <div class="chart-section">
      <h3>Revenue by Location</h3>
      <div class="location-list">
        <div 
          *ngFor="let location of revenueReport()!.revenueByLocation" 
          class="location-item">
          <div class="location-info">
            <span class="location-name">{{ location.location }}</span>
            <span class="location-bookings">{{ location.bookingsCount }} bookings</span>
          </div>
          <div class="location-bar-container">
            <div 
              class="location-bar"
              [style.width.%]="(location.revenue / getMaxRevenue(revenueReport()!.revenueByLocation)) * 100">
            </div>
          </div>
          <span class="location-revenue"><span>EGP</span>{{ location.revenue }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- User Activity Report -->
  <div *ngIf="!loading() && selectedReport() === 'activity' && userActivityReport()" class="report-section">
    <div class="report-header">
      <h2>User Activity Report</h2>
    </div>

    <!-- Activity Summary -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="card-icon users">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
            <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="card-content">
          <p class="card-label">New Users</p>
          <p class="card-value">{{ userActivityReport()!.newUsers }}</p>
        </div>
      </div>

      <div class="summary-card">
        <div class="card-icon active">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="card-content">
          <p class="card-label">Active Users</p>
          <p class="card-value">{{ userActivityReport()!.activeUsers }}</p>
        </div>
      </div>

      <div class="summary-card">
        <div class="card-icon host">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="card-content">
          <p class="card-label">New Hosts</p>
          <p class="card-value">{{ userActivityReport()!.newHosts }}</p>
        </div>
      </div>

      <div class="summary-card">
        <div class="card-icon guests">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="card-content">
          <p class="card-label">New Guests</p>
          <p class="card-value">{{ userActivityReport()!.newGuests }}</p>
        </div>
      </div>
    </div>

    <!-- Daily Activity Chart -->
    <div class="chart-section">
      <h3>Daily Activity</h3>
      <div class="activity-chart">
        <div *ngFor="let day of userActivityReport()!.dailyActivity" class="activity-day">
          <div class="day-bars">
            <div class="bar users" [style.height.%]="(day.newUsers / 50) * 100" title="New Users: {{day.newUsers}}"></div>
            <div class="bar bookings" [style.height.%]="(day.bookings / 50) * 100" title="Bookings: {{day.bookings}}"></div>
          </div>
          <span class="day-label">{{ formatDate(day.date) }}</span>
        </div>
      </div>
      <div class="chart-legend">
        <div class="legend-item">
          <div class="legend-color users"></div>
          <span>New Users</span>
        </div>
        <div class="legend-item">
          <div class="legend-color bookings"></div>
          <span>Bookings</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Occupancy Report -->
  <!-- <div *ngIf="!loading() && selectedReport() === 'occupancy' && occupancyReport()" class="report-section">
    <div class="report-header">
      <h2>Occupancy Report</h2>
      <p class="report-subtitle">Last 30 days</p>
    </div> -->

    <!-- Overall Occupancy -->
    <!-- <div class="occupancy-card">
      <h3>Overall Occupancy Rate</h3>
      <div class="occupancy-circle">
        <svg viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="45" fill="none" stroke="#EBEBEB" stroke-width="10"/>
          <circle 
            cx="50" 
            cy="50" 
            r="45" 
            fill="none" 
            stroke="#FF385C" 
            stroke-width="10"
            [attr.stroke-dasharray]="283"
            [attr.stroke-dashoffset]="283 - (283 * occupancyReport()!.overallOccupancyRate / 100)"
            transform="rotate(-90 50 50)"/>
        </svg>
        <div class="occupancy-value">
          <span class="percentage">{{ formatPercent(occupancyReport()!.overallOccupancyRate) }}</span>
          <span class="label">Occupied</span>
        </div>
      </div>
    </div> -->

    <!-- Top Performing Properties -->
    <!-- <div class="chart-section">
      <h3>Top Performing Properties</h3>
      <div class="property-list">
        <div *ngFor="let property of occupancyReport()!.topProperties.slice(0, 5)" class="property-item">
          <div class="property-info">
            <span class="property-name">{{ property.propertyTitle }}</span>
            <span class="property-stats">
              {{ property.totalBookings }} bookings · <span>EGP</span> {{ property.revenue }}
            </span>
          </div>
          <span class="occupancy-badge high">{{ formatPercent(property.occupancyRate) }}</span>
        </div>
      </div>
    </div> -->

    <!-- Low Performing Properties -->
    <!-- <div class="chart-section">
      <h3>Low Performing Properties</h3>
      <div class="property-list">
        <div *ngFor="let property of occupancyReport()!.lowPerformingProperties.slice(0, 5)" class="property-item">
          <div class="property-info">
            <span class="property-name">{{ property.propertyTitle }}</span>
            <span class="property-stats">
              {{ property.totalBookings }} bookings · <span>EGP</span> {{ property.revenue }}
            </span>
          </div>
          <span class="occupancy-badge low">{{ formatPercent(property.occupancyRate) }}</span>
        </div>
      </div>
    </div> -->
  </div>