<div class="admin-properties">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1>Properties Management</h1>
      <p class="subtitle">Manage all property listings on the platform</p>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-tabs">
      <button 
        class="filter-tab"
        [class.active]="selectedStatus() === 'PendingApproval'"
        (click)="onStatusChange('PendingApproval')">
        Pending Approval
      </button>
      <button 
        class="filter-tab"
        [class.active]="selectedStatus() === 'Approved'"
        (click)="onStatusChange('Approved')">
        Approved
      </button>
      <button 
        class="filter-tab"
        [class.active]="selectedStatus() === 'Active'"
        (click)="onStatusChange('Active')">
        Active
      </button>
      <button 
        class="filter-tab"
        [class.active]="selectedStatus() === 'Rejected'"
        (click)="onStatusChange('Rejected')">
        Rejected
      </button>
      <button 
        class="filter-tab"
        [class.active]="selectedStatus() === 'All'"
        (click)="onStatusChange('All')">
        All
      </button>
    </div>

    <div class="search-box">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
        <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
      </svg>
      <input 
        type="text" 
        placeholder="Search by title or location..."
        [(ngModel)]="searchTerm"
        (keyup.enter)="onSearch()"
      />
      <button class="search-btn" (click)="onSearch()">Search</button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
    <p>Loading properties...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error()" class="error-state">
    <p>{{ error() }}</p>
    <button class="retry-btn" (click)="loadProperties()">Retry</button>
  </div>

  <!-- Properties Grid -->
  <div *ngIf="!loading() && !error()" class="properties-grid">
    <div *ngFor="let property of properties()" class="property-card">
      <!-- Status Badge -->
      <div class="card-status" [ngClass]="getStatusBadgeClass(property.status)">
        {{ property.status }}
      </div>

      <!-- Property Info -->
      <div class="property-header">
        <div style="height: 160px; overflow: hidden; border-radius: 8px; margin-bottom: 12px; background: #f0f0f0;">
            <img [src]="getImageUrl(property.imageUrl)" 
                 style="width: 100%; height: 100%; object-fit: cover;"
                 alt="Property Image">
        </div>
        <h3 class="property-title">{{ property.title }}</h3>
        <p class="property-location">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
          </svg>
          {{ property.location }}
        </p>
      </div>

      <!-- Property Stats -->
      <div class="property-stats">
        <div class="stat-item">
          <span class="stat-label">Price/Night:</span>
          <span class="stat-value price"><span>EGP</span>{{ property.pricePerNight }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Bookings:</span>
          <span class="stat-value">{{ property.totalBookings }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Revenue:</span>
          <span class="stat-value"><span>EGP</span>{{ property.totalRevenue }}</span>
        </div>
        <div class="stat-item" *ngIf="property.averageRating">
          <span class="stat-label">Rating:</span>
          <span class="stat-value">{{ property.averageRating | number:'1.1-1' }} ⭐ ({{ property.reviewsCount }})</span>
        </div>
      </div>

      <!-- Host Info -->
      <div class="host-info">
        <div class="host-avatar">{{ property.hostName.charAt(0) }}</div>
        <div>
          <p class="host-label">Host:</p>
          <p class="host-name">{{ property.hostName }}</p>
        </div>
      </div>

      <!-- Dates -->
      <div class="property-dates">
        <div class="date-info">
          <span class="date-label">Created:</span>
          <span class="date-value">{{ formatDate(property.createdAt) }}</span>
        </div>
        <div class="date-info" *ngIf="property.approvedAt">
          <span class="date-label">Approved:</span>
          <span class="date-value">{{ formatDate(property.approvedAt) }}</span>
        </div>
      </div>

      <!-- Rejection Reason -->
      <div *ngIf="property.rejectionReason" class="rejection-box">
        <strong>Rejection Reason:</strong>
        <p>{{ property.rejectionReason }}</p>
      </div>

      <!-- Actions -->
      <div class="card-actions">
        <!-- Pending Actions -->
        <div *ngIf="property.status === 'PendingApproval'" class="action-row">
          <button class="btn btn-approve" (click)="openApproveModal(property)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2"/>
              <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2"/>
            </svg>
            Approve
          </button>
          <button class="btn btn-reject" (click)="openRejectModal(property)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
              <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
            </svg>
            Reject
          </button>
        </div>

        <!-- Active/Approved Actions -->
        <div *ngIf="property.status === 'Active' || property.status === 'Approved'" class="action-row">
          <button class="btn btn-suspend" (click)="suspendProperty(property)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <line x1="4.93" y1="4.93" x2="19.07" y2="19.07" stroke="currentColor" stroke-width="2"/>
            </svg>
            Suspend
          </button>
        </div>

        <!-- Suspended Actions -->
        <div *ngIf="property.status === 'Suspended'" class="action-row">
          <button class="btn btn-activate" (click)="activateProperty(property)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2"/>
              <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2"/>
            </svg>
            Activate
          </button>
        </div>

        <div *ngIf="property.status === 'Rejected'" class="action-row">
          <button class="btn btn-secondary" (click)="moveToPending(property)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3 3v5h5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Move to Pending
          </button>
        </div>

        <!-- Delete Button (Always Available) -->
        <button class="btn btn-delete" (click)="openDeleteModal(property)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2"/>
          </svg>
          Delete
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="properties().length === 0" class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2"/>
        <polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2"/>
      </svg>
      <h3>No properties found</h3>
      <p>Try adjusting your filters or search terms</p>
    </div>

  </div>

  <!-- Approve Modal -->
  <div class="modal-overlay" *ngIf="showApproveModal()" (click)="closeApproveModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Approve Property</h2>
        <button class="close-btn" (click)="closeApproveModal()">×</button>
      </div>
      <div class="modal-body">
        <p>You are approving the property:</p>
        <div class="property-preview">
          <h3>{{ selectedProperty()?.title }}</h3>
          <p>{{ selectedProperty()?.location }}</p>
          <p class="price"><span>EGP</span>{{selectedProperty()?.pricePerNight || 0 }}/night</p>
        </div>
        <p>This property will become visible to guests and available for booking.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>
        <button class="btn btn-success" (click)="approveProperty()">Approve Property</button>
      </div>
    </div>
  </div>

  <!-- Reject Modal -->
  <div class="modal-overlay" *ngIf="showRejectModal()" (click)="closeRejectModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Reject Property</h2>
        <button class="close-btn" (click)="closeRejectModal()">×</button>
      </div>
      <div class="modal-body">
        <p>You are rejecting: <strong>{{ selectedProperty()?.title }}</strong></p>
        <label>Rejection Reason (Required):</label>
        <textarea 
          class="modal-textarea"
          placeholder="Provide a clear reason for rejection (e.g., unclear photos, inaccurate description, violates policies)..."
          [(ngModel)]="rejectionReason"
          rows="4">
        </textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeRejectModal()">Cancel</button>
        <button class="btn btn-danger" (click)="rejectProperty()">Reject Property</button>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal-overlay" *ngIf="showDeleteModal()" (click)="closeDeleteModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Delete Property</h2>
        <button class="close-btn" (click)="closeDeleteModal()">×</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete <strong>{{ selectedProperty()?.title }}</strong>?</p>
        <p class="warning-text">This action cannot be undone. All associated bookings and data will be affected.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" (click)="deleteProperty()">Delete Property</button>
      </div>
    </div>
  </div>
</div>