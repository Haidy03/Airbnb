<div class="booking-card">

  <!-- Header -->
  <div class="card-header">
    <div class="price">
      <span class="amount">{{ pricePerNight | number }} {{ currency }}</span>
      <span class="period">night</span>
    </div>
    <div class="rating" *ngIf="(reviewsCount ?? 0) > 0">
      <span class="star">★</span> {{ rating }} · <u>{{ reviewsCount }} reviews</u>
    </div>
  </div>

  <!-- Booking Form -->
  <div class="booking-form">
    
    <!-- ✅ منطقة التواريخ (تفتح الـ Popup) -->
    <div class="date-picker-wrapper" (click)="toggleCalendarModal()">
      <div class="date-input check-in">
         <label>CHECK-IN</label>
         <div class="fake-input">{{ checkInDate || 'Add date' }}</div>
      </div>
      <div class="date-input check-out">
        <label>CHECK-OUT</label>
        <div class="fake-input">{{ checkOutDate || 'Add date' }}</div>
      </div>
    </div>

    <!-- ✅ الـ Popup Calendar (يظهر فوق الكارت) -->
    <div class="calendar-popup" *ngIf="isCalendarOpen">
      <!-- نستخدم نفس المكون الموجود في الصفحة الرئيسية -->
      <app-calendar-section
         [checkIn]="checkInDate"
         [checkOut]="checkOutDate"
         [blockedDates]="blockedDates" 
         (datesSelected)="onPopupDatesSelected($event)">
      </app-calendar-section>
      
      <div class="popup-footer">
        <button class="close-link" (click)="closeCalendar()">Close</button>
      </div>
    </div>

    <!-- Guests Dropdown (كما هو) -->
    <div class="guests-input-container">
       <!-- ... (نفس كود الضيوف السابق) ... -->
       <div class="guests-trigger" (click)="toggleGuestMenu()">
          <div class="label-text">
            <label>GUESTS</label>
            <span>{{ guestLabel }}</span>
          </div>
          <i class="fa-solid" [class.fa-chevron-up]="isGuestMenuOpen" [class.fa-chevron-down]="!isGuestMenuOpen"></i>
       </div>

       <div class="guests-dropdown" *ngIf="isGuestMenuOpen">
          <!-- ... أزرار الضيوف ... -->
          <!-- (نسخ نفس كود الضيوف السابق هنا) -->
          <div class="guest-row">
             <div class="info">Adults</div>
             <div class="controls">
               <button class="round-btn" (click)="updateCount('adults', -1)">-</button>
               <span>{{ guests.adults }}</span>
               <button class="round-btn" (click)="updateCount('adults', 1)">+</button>
             </div>
          </div>
          <!-- ... -->
          <div class="dropdown-footer">
             <button class="close-link" (click)="toggleGuestMenu()">Close</button>
          </div>
       </div>
    </div>

  </div>

  <!-- Reserve Button -->
  <button class="reserve-btn" (click)="onReserve()">
     {{ isInstantBook ? 'Request to Book' : 'Reserve' }}
  </button>
  
  <p class="no-charge-text" *ngIf="!priceBreakdown">You won't be charged yet</p>

  <!-- Price Breakdown -->
  <div class="price-breakdown" *ngIf="priceBreakdown">
    <div class="line-item">
      <span class="desc">{{ priceBreakdown.basePrice }} x {{ priceBreakdown.totalNights }} nights</span>
      <span class="value">{{ priceBreakdown.subTotal }} {{ currency }}</span>
    </div>
    <!-- ... باقي التفاصيل ... -->
    <div class="line-item total">
      <span>Total</span>
      <span>{{ priceBreakdown.finalTotalPrice }} {{ currency }}</span>
    </div>
  </div>

</div>