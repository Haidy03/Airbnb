<!-- الحاوية الرئيسية للهيدر -->
<div class="header-container sticky-top bg-white border-bottom"
     [class.scrolled]="isScrolled || !isSearchEnabled">

  <div class="container-fluid px-4 px-md-5">

    <!-- 1. Top Row (Logo, Small Search, User Menu) -->
    <!-- هذا الصف يحتوي على اللوجو والبحث الصغير والقائمة -->
    <div class="nav-top row align-items-center justify-content-between py-3">

      <!-- Left: Logo -->
      <div class="col-auto">
        <a (click)="navigateToHome()" class="text-decoration-none d-flex align-items-center cursor-pointer" style="color: #FF385C;">
           <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2c-4.97 0-9 4.03-9 9 0 4.97 4.03 9 9 9s9-4.03 9-9c0-4.97-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7 0-3.87 3.13-7 7-7s7 3.13 7 7c0 3.87-3.13 7-7 7z"/>
            <path d="M12 4l-8 14h16z" fill="white" transform="scale(0.5) translate(12,8)"/>
          </svg>
          <span class="fw-bold fs-4 ms-1 d-none d-lg-block">airbnb</span>
        </a>
      </div>

      <!-- Center: Small Search Pill -->
      <!-- يظهر فقط عند السكرول وفي الصفحات المسموح بها -->
      <div class="col d-flex justify-content-center position-absolute start-0 w-100"
           style="pointer-events: none; z-index: 0;"
           *ngIf="isScrolled && isSearchEnabled">

        <div class="search-pill shadow-sm border d-flex align-items-center ps-3 pe-1 py-1 rounded-pill bg-white cursor-pointer"
             style="pointer-events: auto;"
             (click)="expandHeader()">
          <span class="fw-semibold px-2 border-end text-truncate" style="max-width: 100px;">Anywhere</span>
          <span class="fw-semibold px-2 border-end text-truncate" style="max-width: 100px;">Any week</span>
          <span class="text-secondary px-2 text-truncate" style="max-width: 100px;">Add guests</span>
          <button class="btn btn-danger rounded-circle d-flex align-items-center justify-content-center ms-2" style="width: 32px; height: 32px; background-color: #FF385C;">
            <i class="bi bi-search text-white" style="font-size: 12px;"></i>
          </button>
        </div>
      </div>

      <!-- Right: User Menu -->
      <div class="col-auto d-flex align-items-center gap-2 position-relative z-index-10">

        <a class="host-btn d-none d-md-block text-dark text-decoration-none fw-semibold px-3 py-2 rounded-pill hover-bg-light" (click)="onBecomeHostClick()" style="cursor: pointer;">
          Become a host
        </a>

        <button class="btn btn-light rounded-circle p-2 bg-transparent border-0 host-btn px-2">
          <i class="bi bi-globe fs-5"></i>
        </button>

        <!-- Dropdown Trigger -->
        <div class="position-relative">
          <button class="user-menu-btn border rounded-pill p-1 ps-2 d-flex align-items-center gap-2 bg-white hover-shadow transition"
                  (click)="toggleUserMenu($event)">
            <i class="bi bi-list fs-5"></i>
            <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center text-white" style="width: 30px; height: 30px;">
              <i class="bi bi-person-fill fs-5"></i>
            </div>
          </button>

          <!-- Dropdown Content -->
          <div *ngIf="isUserMenuOpen" class="custom-dropdown shadow-lg rounded-4 py-2 bg-white position-absolute end-0 mt-2"
               style="width: 240px; z-index: 1050;"
               (click)="$event.stopPropagation()">
            <div class="d-flex flex-column">
               <a routerLink="/profile" class="dropdown-item px-3 py-2 fw-semibold text-dark text-decoration-none hover-bg-light">Profile</a>
               <a routerLink="/messages" class="dropdown-item px-3 py-2 fw-semibold text-dark text-decoration-none hover-bg-light">Messages</a>
               <a routerLink="/trips" class="dropdown-item px-3 py-2 fw-semibold text-dark text-decoration-none hover-bg-light">Trips</a>
               <a routerLink="/wishlists" class="dropdown-item px-3 py-2 fw-semibold text-dark text-decoration-none hover-bg-light">Wishlists</a>
               <div class="border-bottom my-2"></div>
               <a routerLink="/account-settings" class="dropdown-item px-3 py-2 text-dark text-decoration-none hover-bg-light">Account settings</a>
               <a (click)="isLoggedIn ? onLogout() : openLoginModal()" class="dropdown-item px-3 py-2 text-dark text-decoration-none hover-bg-light cursor-pointer">{{ isLoggedIn ? 'Log out' : 'Log in or sign up' }}</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- إغلاق nav-top -->

    <!-- 2. Big Search Bar Row -->
    <!-- يظهر فقط إذا لم نقم بالسكرول والبحث مسموح -->
    <div class="row justify-content-center big-search-wrapper pb-3"
         *ngIf="!isScrolled && isSearchEnabled">
      <div class="col-12 d-flex justify-content-center">
        <div class="w-100 d-flex justify-content-center">
            <app-search-bar [showFilters]="false" (search)="handleSearch($event)"></app-search-bar>
        </div>
      </div>
    </div>

  </div>
  <!-- إغلاق container-fluid -->

</div>
<!-- إغلاق header-container (هنا كان سبب الخطأ غالباً) -->
