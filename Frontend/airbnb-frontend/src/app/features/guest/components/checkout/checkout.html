
<div class="checkout-page" *ngIf="listing">

  <header class="checkout-header">
    <button class="icon-btn back-btn" (click)="goBack()">
      <i class="fa-solid fa-chevron-left"></i>
    </button>
    <h1>Confirm and pay</h1>
  </header>

  <div class="main-grid">

    <!-- LEFT COLUMN -->
    <div class="left-section">

      <!-- نموذج العنوان فقط -->
      <form [formGroup]="paymentForm">

        <div class="step-header">
          <h2>1. Pay with</h2>
        </div>

        <!-- البوكس اللي كان فيه الفيزا، هنحط فيه باي بال -->
        <div class="payment-card-box">

          <div class="payment-method-header">
            <div class="method-info">
              <!-- أيقونة باي بال -->
              <i class="fa-brands fa-paypal" style="color: #003087;"></i>
              <span>PayPal</span>
            </div>
            <div class="radio-circle" style="border-color: #003087; background: #003087;"></div>
          </div>

          <!-- مكان زرار باي بال -->
          <div class="paypal-wrapper">
             <ngx-paypal [config]="payPalConfig"></ngx-paypal>
          </div>

          <p class="secure-text">
            <i class="fa-solid fa-lock"></i> Payments are secure and encrypted.
          </p>

        </div>


        

        <!-- زرار الـ Next الأسود القديم هنشيله خلاص، لأن زرار باي بال هو اللي هيدفع -->

      </form>

    </div>

    <!-- RIGHT COLUMN (Summary) -->
   <!-- ================= RIGHT COLUMN (SUMMARY CARD) ================= -->
    <div class="right-section">
      <div class="sticky-wrapper">

        <div class="summary-card">
          <!-- Listing Header -->
          <div class="card-header-row">
            <img [src]="listing.images[0]" alt="Listing">
            <div class="text-info">
              <span class="superhost-tag" *ngIf="listing.host.isSuperhost">Superhost</span>
              <p class="listing-desc">Entire rental unit</p>
              <h4>{{ listing.title }}</h4>
              <div class="rating">
                <i class="fa-solid fa-star"></i> {{ listing.rating }}
                <span class="count">({{ listing.reviewsCount }} reviews)</span>
              </div>
            </div>
          </div>

          <hr class="divider">

          <!-- Cancellation Policy -->
          <div class="policy-section">
            <h4>Free cancellation</h4>
            <p>Cancel before check-in for a full refund. <a href="#">Full policy</a></p>
          </div>

          <hr class="divider">

          <!-- Dates & Guests -->
          <div class="trip-details">
            <div class="detail-row">
              <div class="label">
                <h4>Dates</h4>
                <p>{{ checkIn | date:'MMM d' }} – {{ checkOut | date:'d, y' }}</p>
              </div>
              <button class="link-btn" (click)="openDateModal()">Change</button>
            </div>

            <div class="detail-row">
              <div class="label">
                <h4>Guests</h4>
                <p>{{ guests }} guest{{ guests > 1 ? 's' : '' }}</p>
              </div>
              <button class="link-btn" (click)="openGuestModal()">Change</button>
            </div>
          </div>

          <hr class="divider">

          <!-- Price Breakdown -->
          <div class="price-section">
            <h4>Price details</h4>

            <div class="line-item">
              <span>{{ nights }} night{{ nights > 1 ? 's' : '' }} x {{ listing.pricePerNight | number }} EGP</span>
              <span>{{ listing.pricePerNight * nights | number }} EGP</span>
            </div>

            <div class="line-item">
              <span>Service fee</span>
              <span>{{ serviceFee | number }} EGP</span>
            </div>

            <hr class="divider">

            <div class="line-item total">
              <span>Total (EGP)</span>
              <span>{{ totalPrice | number }} EGP</span>
            </div>
          </div>
        </div>

        <!-- Rare Find Box -->
        <div class="rare-find-box">
          <i class="fa-regular fa-gem"></i>
          <div class="text">
            <h4>This is a rare find.</h4>
            <p>{{ listing.host.name }}'s place is usually booked.</p>
          </div>
        </div>

      </div>
    </div>

  </div>


  <!-- ================= MODALS ================= -->

  <!-- Edit Dates Modal -->
  <div class="modal-overlay" *ngIf="isEditDateOpen">
    <div class="modal-box">
      <h3>Change Dates</h3>
      <div class="modal-inputs">
        <label>Check-in</label>
        <input type="date" [(ngModel)]="tempCheckIn">
        <label>Check-out</label>
        <input type="date" [(ngModel)]="tempCheckOut">
      </div>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeDateModal()">Cancel</button>
        <button class="save-btn" (click)="saveDates()">Save</button>
      </div>
    </div>
  </div>

  <!-- Edit Guests Modal -->
  <div class="modal-overlay" *ngIf="isEditGuestOpen">
    <div class="modal-box">
      <h3>Change Guests</h3>
      <div class="modal-inputs">
        <label>Adults</label>
        <input type="number" min="1" max="10" [(ngModel)]="tempGuests">
      </div>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeGuestModal()">Cancel</button>
        <button class="save-btn" (click)="saveGuests()">Save</button>
      </div>

    </div>

  </div>
</div>
