<div class="search-wrapper d-flex flex-column align-items-center w-100">

  <!-- ✅ Tabs Switcher (Only visible when expanded usually, or always) -->
  <div class="search-tabs d-flex gap-4 mb-3">
    <button class="tab-btn" [class.active]="searchType === 'stays'" (click)="setSearchType('stays')">Stays</button>
    <button class="tab-btn" [class.active]="searchType === 'services'" (click)="setSearchType('services')">Services</button>
  </div>

  <div class="d-flex align-items-center gap-3 w-100 justify-content-center">

    <div class="search-bar-container flex-grow-1" style="max-width: 850px;">
      <div class="search-bar">

        <!-- ==================== STAYS SEARCH UI ==================== -->
        <ng-container *ngIf="searchType === 'stays'">
          <!-- 1. Location -->
          <div class="search-input-wrapper location-input" [class.active]="activeInput === 'location'">
            <label class="input-label">Where</label>
            <input type="text" class="search-input" placeholder="Search destinations"
                   [(ngModel)]="location" (focus)="onInputFocus('location')" (blur)="onInputBlur()">
            <button *ngIf="location" class="clear-btn" (click)="clearLocation()" type="button"><i class="bi bi-x-circle-fill"></i></button>
            
            <div *ngIf="showLocationsDropdown && availableLocations.length > 0" class="locations-dropdown" (mousedown)="$event.preventDefault()">
                <div class="location-item" *ngFor="let city of availableLocations" (click)="selectLocation(city)">
                    <div class="loc-icon-wrapper"><i class="bi bi-geo-alt-fill"></i></div>
                    <div class="loc-text">{{ city }}</div>
                </div>
            </div>
          </div>

          <div class="search-divider"></div>

          <!-- 2. Check In -->
          <div class="search-input-wrapper date-input" [class.active]="activeInput === 'checkIn'" (click)="startDate.showPicker()">
            <label class="input-label">Check in</label>
            <input #startDate type="date" class="search-input" [(ngModel)]="checkIn" [min]="minDate" (focus)="onInputFocus('checkIn')" (blur)="onInputBlur()">
            <button *ngIf="checkIn" class="clear-btn" (click)="clearDate('checkIn', $event)" type="button"><i class="bi bi-x-circle-fill"></i></button>
          </div>

          <div class="search-divider"></div>

          <!-- 3. Check Out -->
          <div class="search-input-wrapper date-input" [class.active]="activeInput === 'checkOut'" (click)="endDate.showPicker()">
            <label class="input-label">Check out</label>
            <input #endDate type="date" class="search-input" [(ngModel)]="checkOut" [min]="checkIn ? checkIn : minDate" (focus)="onInputFocus('checkOut')" (blur)="onInputBlur()">
            <button *ngIf="checkOut" class="clear-btn" (click)="clearDate('checkOut', $event)" type="button"><i class="bi bi-x-circle-fill"></i></button>
          </div>

          <div class="search-divider"></div>

          <!-- 4. Who -->
          <div class="search-input-wrapper guests-input" [class.active]="activeInput === 'guests'">
            <label class="input-label">Who</label>
            <input type="text" class="search-input" [value]="guestsText" readonly placeholder="Add guests" (focus)="onInputFocus('guests')" (blur)="onInputBlur()">
            
            <div *ngIf="showGuestsDropdown" class="guests-dropdown" (mousedown)="$event.preventDefault()">
              <!-- Guests Rows (Same as before) -->
               <div class="guest-row">
                  <div class="guest-info"><div>Adults</div><div class="guest-description fw-light">Ages 13+</div></div>
                  <div class="guest-controls">
                    <button class="guest-btn" [disabled]="adultsCount<=0" (click)="decrementGuests('adults')">-</button>
                    <span class="guest-count">{{adultsCount}}</span>
                    <button class="guest-btn" (click)="incrementGuests('adults')">+</button>
                  </div>
               </div>
               <!-- Repeat for Children, Infants, Pets if needed -->
            </div>
          </div>
        </ng-container>

        <!-- ==================== SERVICES SEARCH UI (NEW) ==================== -->
        <ng-container *ngIf="searchType === 'services'">
          
          <!-- 1. Service Name (Query) -->
          <div class="search-input-wrapper flex-grow-1" [class.active]="activeInput === 'serviceQuery'">
            <label class="input-label">Service</label>
            <input type="text" class="search-input" placeholder="Chef, Cleaning, Beauty..."
                   [(ngModel)]="serviceQuery" (focus)="onInputFocus('serviceQuery')" (blur)="onInputBlur()">
          </div>

          <div class="search-divider"></div>

          <!-- 2. Category Dropdown -->
          <div class="search-input-wrapper flex-grow-1" [class.active]="activeInput === 'serviceCategory'">
            <label class="input-label">Category</label>
            <input type="text" class="search-input" placeholder="Select category" readonly
                   [value]="selectedCategory" (focus)="onInputFocus('serviceCategory')" (blur)="onInputBlur()">
            
            <button *ngIf="selectedCategory" class="clear-btn" (click)="clearCategory($event)" type="button"><i class="bi bi-x-circle-fill"></i></button>

            <div *ngIf="showCategoriesDropdown" class="locations-dropdown" (mousedown)="$event.preventDefault()">
                <div class="location-item" *ngFor="let cat of serviceCategories" (click)="selectCategory(cat.name)">
                    <div class="loc-icon-wrapper">
                      <!-- عرض الأيقونة إذا كانت موجودة كرابط -->
                      <img [src]="cat.icon" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                    </div>
                    <div class="loc-text">{{ cat.name }}</div>
                </div>
            </div>
          </div>

        </ng-container>

        <!-- Search Button -->
        <button class="search-btn" (click)="onSearch()" type="button">
          <i class="bi bi-search"></i>
          <span class="search-btn-text">Search</span>
        </button>
      </div>
    </div>

    <button *ngIf="withFilterButton && searchType === 'stays'"
            class="side-filter-btn d-flex align-items-center justify-content-center"
            (click)="onFiltersClick()"
            title="Filters">
      <i class="bi bi-sliders2 fs-5"></i>
      <span class="ms-2 fw-semibold d-none d-xl-inline">Filters</span>
    </button>

  </div>
</div>