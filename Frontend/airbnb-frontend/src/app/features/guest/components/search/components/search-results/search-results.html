<div class="search-results-container">

  <!-- Filter Modal Component -->
  <app-filters
    [isOpen]="showFilters"
    [currentFilters]="currentQuery.filters"
    (close)="onFiltersClose()"
    (applyFilters)="onFiltersApply($event)"
  ></app-filters>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="d-flex justify-content-center align-items-center w-100 py-5" style="min-height: 50vh;">
    <div class="spinner-border text-danger" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  
  <!-- Content Area -->
  <div class="results-content" *ngIf="!isLoading">

    <!-- Left Side: List Section -->
    <div class="results-list-section" [class.with-map]="showMap">
      <div class="container-fluid px-3"> 

        <!-- Header: Count & Clear Filter Button -->
        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 mt-2">
          
          <div class="d-flex align-items-center gap-3">
            <h1 class="h5 fw-bold text-dark mb-0">
              {{ totalResults }} homes found
            </h1>
            
            <!-- Clear Filters Button (Shows only if active filters exist) -->
            <button *ngIf="hasActiveFilters" 
                    class="btn btn-link text-danger text-decoration-none p-0 fw-semibold d-flex align-items-center"
                    style="font-size: 14px;"
                    (click)="clearFilters()">
              Clear filters <i class="bi bi-x fs-5"></i>
            </button>
          </div>

        </div>

        <!-- Mobile Map Toggle Button -->
        <button class="map-toggle-btn d-lg-none" (click)="toggleMap()" type="button">
          <i class="bi" [ngClass]="showMap ? 'bi-list' : 'bi-map'"></i>
          <span>{{ showMap ? 'Show list' : 'Show map' }}</span>
        </button>

        <!-- Properties Grid -->
        <div *ngIf="properties.length > 0">
           <div class="row g-4">
            
             <!-- Responsive Columns based on Map Visibility -->
             <div [class]="showMap ? 'col-12 col-sm-6 col-lg-4 col-xl-4' : 'col-12 col-sm-6 col-md-4 col-lg-3'"
                  *ngFor="let property of properties">

                <app-property-card
                  [property]="property"
                  [isFavorite]="isPropertyInWishlist(property.id)"
                  (favoriteToggle)="onToggleWishlist(property)"
                  (cardClick)="onPropertySelect(property.id)"
                  (mouseenter)="onPropertyHover(property.id)"
                  (mouseleave)="onPropertyHover(null)">
                </app-property-card>

             </div>
           </div>
        </div>

        <!-- Pagination -->
        <div class="mt-5 mb-4" *ngIf="properties.length > 0 && totalItems > pageSize">
          <app-pagination
            [totalItems]="totalItems"
            [itemsPerPage]="pageSize"
            [currentPage]="currentPage"
            (pageChanged)="onPageChange($event)">
          </app-pagination>
        </div>

        <!-- Empty State -->
        <div *ngIf="properties.length === 0" class="text-center py-5 mt-5">
          <i class="bi bi-search display-4 text-muted mb-3 d-block"></i>
          <h3 class="fw-bold text-dark">No properties found</h3>
          <p class="text-muted mb-4">Try adjusting your search or filters to find what you're looking for.</p>
          
          <!-- Clear All Filters Button for Empty State -->
          <button class="btn btn-outline-dark px-4 py-2" (click)="clearFilters()">
            Clear all filters
          </button>
        </div>

      </div>
    </div>

    <!-- Right Side: Map Section -->
    <div class="results-map-section" *ngIf="showMap" [class.mobile-fullscreen]="!isDesktop">
      <app-search-map
        [properties]="properties"
        [selectedPropertyId]="selectedProperty?.id || null"
        (propertySelect)="onMapPropertySelect($event)"
        (mapBoundsChange)="onMapBoundsChange($event)"
        (mapBackgroundClick)="onMapBackgroundClick()"
      ></app-search-map>

      <!-- Close Map Button (Mobile Only) -->
      <button class="close-map-btn d-lg-none" (click)="toggleMap()" type="button">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

  </div>
</div>