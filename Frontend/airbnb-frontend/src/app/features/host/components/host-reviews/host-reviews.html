<div class="reviews-page" *ngIf="!isLoading(); else loadingTpl">
  
  <h1 class="page-title">Reviews</h1>

  <!-- Header Stats -->
  <div class="reviews-header">
    <span class="big-rating">{{ stats()?.overallRating | number:'1.2-2' }}</span>
    <div class="stars-container">
      <span class="star-icon">★</span>
      <span class="review-count">{{ stats()?.totalReviews }} reviews</span>
    </div>
  </div>

  <div class="reviews-layout">
    
    <!-- LEFT COLUMN: Rating Breakdown -->
    <aside class="rating-breakdown">
      <h3 class="breakdown-title">Rating breakdown</h3>
      
      <div class="breakdown-list">
        <!-- Cleanliness -->
        <div class="breakdown-item">
          <span class="label">Cleanliness</span>
          <div class="bar-wrapper">
            <div class="bar-fill" [style.width.%]="(stats()?.cleanlinessAvg || 0) * 20"></div>
          </div>
          <span class="value">{{ stats()?.cleanlinessAvg | number:'1.1-1' }}</span>
        </div>

        <!-- Communication -->
        <div class="breakdown-item">
          <span class="label">Communication</span>
          <div class="bar-wrapper">
            <div class="bar-fill" [style.width.%]="(stats()?.communicationAvg || 0) * 20"></div>
          </div>
          <span class="value">{{ stats()?.communicationAvg | number:'1.1-1' }}</span>
        </div>

        <!-- Location -->
        <div class="breakdown-item">
          <span class="label">Location</span>
          <div class="bar-wrapper">
            <div class="bar-fill" [style.width.%]="(stats()?.locationAvg || 0) * 20"></div>
          </div>
          <span class="value">{{ stats()?.locationAvg | number:'1.1-1' }}</span>
        </div>

        <!-- Value -->
        <div class="breakdown-item">
          <span class="label">Value</span>
          <div class="bar-wrapper">
            <div class="bar-fill" [style.width.%]="(stats()?.valueAvg || 0) * 20"></div>
          </div>
          <span class="value">{{ stats()?.valueAvg | number:'1.1-1' }}</span>
        </div>
      </div>
    </aside>

    <!-- RIGHT COLUMN: Reviews Feed -->
    <div class="reviews-feed">
      
      <div class="review-card" *ngFor="let review of stats()?.reviews">
        <div class="review-header">
          <!-- الصورة -->
          <img 
            [src]="getImageUrl(review.reviewerProfileImage)" 
            class="avatar" 
            alt="Guest"
            loading="lazy">
          
          <div class="reviewer-info">
            <!-- الاسم -->
            <h3 class="guest-name">{{ review.reviewerName }}</h3>
            
            <!-- الصف (النجوم + التاريخ) -->
            <div class="review-meta">
              <!-- عرض التقييم -->
              <div class="individual-rating" *ngIf="review.rating">
                <span class="small-star">★</span>
                <span>{{ review.rating }}</span>
              </div>
              <span *ngIf="review.rating">·</span>
              
              <!-- التاريخ -->
              <span class="date">{{ review.createdAt | date:'MMMM yyyy' }}</span>
            </div>

            <!-- البادجات الملونة (Experience / Service) -->
            <div class="tags-container">
              <span class="tag tag-experience" *ngIf="review.reviewType === 'Experience'">
                <i class="bi bi-heart-fill"></i> Experience
              </span>
              
              <span class="tag tag-service" *ngIf="review.reviewType === 'Service'">
                <i class="bi bi-bell-fill"></i> Service
              </span>
               <span class="tag tag-property" 
      *ngIf="review.reviewType === 'GuestToProperty' || review.reviewType === 'Property'">
  <i class="bi bi-house-door-fill"></i> Property
</span>
            </div>

            <!-- اسم العقار أو الخدمة -->
            <span class="context-title">{{ review.propertyTitle }}</span>
          </div>
        </div>

        <div class="review-body">
          <p class="review-text">{{ review.comment }}</p>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="stats()?.reviews?.length === 0" class="empty-state">
        <p>No reviews yet.</p>
      </div>

    </div>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="loading-screen">Loading reviews...</div>
</ng-template>