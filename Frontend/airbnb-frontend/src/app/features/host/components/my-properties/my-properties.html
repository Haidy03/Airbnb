<div class="listings-page">
  
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">Your listings</h1>
    
    <div class="header-actions">
      <button class="view-toggle-btn" (click)="toggleViewMode()" title="Toggle view">
        <svg *ngIf="viewMode() === 'grid'" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
        <svg *ngIf="viewMode() === 'list'" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"/>
          <rect x="14" y="3" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/>
          <rect x="3" y="14" width="7" height="7"/>
        </svg>
      </button>

      <button class="add-property-btn" (click)="addNewProperty()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-container">
    <div class="spinner"></div>
    <p>Loading your listings...</p>
  </div>

  <!-- Properties Grid/List -->
  <div *ngIf="!isLoading() && properties().length > 0" class="properties-grid" [class.list-view]="viewMode() === 'list'">
    
    <div *ngFor="let property of properties()" 
         class="property-card"
         [class.is-draft]="isDraft(property)"
         [class.is-complete]="isDraft(property) && getProgressPercentage(property) === 100">
      
      <!-- Property Image -->
      <div class="property-image" (click)="editProperty(property)">
        <img [src]="getPropertyImage(property)" 
             [alt]="getPropertyTitle(property)"
             *ngIf="getPropertyImage(property)">
        
        <div class="image-placeholder" *ngIf="!getPropertyImage(property)">
          <svg width="80" height="80" viewBox="0 0 80 80" fill="#CCCCCC">
            <path d="M40 10L10 30v40h60V30L40 10zm0 8l20 15v27H20V33l20-15z"/>
          </svg>
        </div>

        <!-- Status Badge -->
        <div class="status-badge" [ngClass]="getStatusBadgeClass(property)">
          <span class="status-dot"></span>
          <span class="status-text">{{ getStatusLabel(property) }}</span>
        </div>

        <!-- Progress Bar for Drafts -->
        <div class="progress-bar" *ngIf="isDraft(property)">
          <div class="progress-fill" [style.width.%]="getProgressPercentage(property)"></div>
        </div>

        <!-- Quick Action Overlay -->
        <div class="quick-actions-overlay">
          <button 
            class="quick-action-btn edit-btn" 
            (click)="editProperty(property); $event.stopPropagation()"
            title="Edit/Continue">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="white">
              <path d="M15.5 2.5L17.5 4.5L6.5 15.5L2.5 17.5L4.5 13.5L15.5 2.5Z"/>
            </svg>
          </button>

          <button 
            *ngIf="isDraft(property)"
            class="quick-action-btn delete-btn" 
            (click)="deleteDraft(property, $event)"
            title="Delete draft">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="white">
              <path d="M3 5v14c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V5m-12-1h12V2H3v2zm2 3v11h2V7H5zm4 0v11h2V7H9zm4 0v11h2V7h-2z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Property Info -->
      <div class="property-info">
         <div class="property-header">
          <div class="property-title-section">
            <h3 class="property-title" (click)="editProperty(property)">
              {{ getPropertyTitle(property) }}
            </h3>
            
            <!-- Step badge for drafts -->
            <span class="step-badge" *ngIf="isDraft(property) && getProgressPercentage(property) < 100">
              {{ getCurrentStep(property) }}
            </span>
          </div>
          
          <!-- âœ… FIXED: Show toggle for published properties OR ready-to-publish button for complete drafts -->
          
          <!-- Toggle for already published properties -->
          <label class="publish-toggle" 
                 *ngIf="isPublished(property)"
                 (click)="$event.stopPropagation()"
                 title="Publish/Unpublish">
            <input 
              type="checkbox" 
              [checked]="true"
              (change)="togglePublishStatus(property, $event)">
            <span class="toggle-slider"></span>
          </label>

          <!-- Publish Button for complete drafts (100% progress) -->
          <button class="ready-publish-btn" 
                  *ngIf="isDraft(property) && getProgressPercentage(property) === 100 && !isPublished(property)"
                  (click)="togglePublishStatus(property, $event)"
                  title="Publish this listing">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm4 6l-5 5-3-3-1.4 1.4L7 13l6.4-6.4L12 6z"/>
            </svg>
            Publish
          </button>
        </div>
        
        <p class="property-location">{{ getLocationString(property) }}</p>

        <!-- Progress Indicator for Drafts -->
        <div class="draft-progress" *ngIf="isDraft(property)">
          <div class="progress-info">
            <span class="progress-label">Progress</span>
            <span class="progress-percentage">{{ getProgressPercentage(property) }}%</span>
          </div>
          <div class="progress-bar-full">
            <div class="progress-bar-fill" [style.width.%]="getProgressPercentage(property)"></div>
          </div>
        </div>
        
        <!-- Property Stats -->
        <div class="property-stats" *ngIf="isPublished(property)">
          <span class="stat-item">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0L10 5h5l-4 3 1.5 5L8 10l-4.5 3L5 8 1 5h5z"/>
            </svg>
            {{ getAverageRating(property) }}
          </span>
          <span class="stat-item">
           {{ getTotalReviews(property) }} reviews
          </span>
          <span class="stat-item">
            {{ getPricePerNight(property) }}/night
          </span>
        </div>

        <!-- Draft Stats -->
        <div class="draft-stats" *ngIf="isDraft(property)">
          <span class="stat-item">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 2c3.3 0 6 2.7 6 6s-2.7 6-6 6-6-2.7-6-6 2.7-6 6-6zm1 9H7V7h2v4z"/>
            </svg>
            {{ getImageCount(property) }} photos
          </span>
          <span class="stat-item">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M14 2H2C.9 2 .04 2.9.04 4L0 15c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 13H2V4h12v11z"/>
            </svg>
            {{ getAmenitiesCount(property) }} amenities
          </span>
          <span class="stat-item">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm.5 12H7V8h1.5v4zm0-6H7V4h1.5v2z"/>
            </svg>
            {{ getPricePerNight(property) }}/night
          </span>
        </div>
      </div>

    </div>

  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading() && properties().length === 0" class="empty-state">
    <div class="empty-illustration">
      <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
        <rect x="30" y="40" width="60" height="50" rx="4" stroke="#DDDDDD" stroke-width="2"/>
        <path d="M30 60L60 40L90 60" stroke="#DDDDDD" stroke-width="2" fill="none"/>
        <rect x="50" y="65" width="20" height="25" fill="#EBEBEB"/>
        <rect x="40" y="50" width="10" height="10" fill="#EBEBEB"/>
        <rect x="70" y="50" width="10" height="10" fill="#EBEBEB"/>
      </svg>
    </div>
    
    <h2 class="empty-title">No listings yet</h2>
    <p class="empty-description">
      Create your first listing to start hosting and earning.
    </p>
    
    <button class="create-listing-btn" (click)="addNewProperty()">
      Create your first listing
    </button>
  </div>

</div>