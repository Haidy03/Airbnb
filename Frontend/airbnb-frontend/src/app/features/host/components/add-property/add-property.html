<div class="add-property-container">
  <!-- Header -->
  <div class="header">
    <h1>Add New Property</h1>
    <p class="subtitle">Share your space with travelers around the world</p>
  </div>

  <!-- Progress Bar -->
  <div class="progress-section">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
    </div>
    <div class="steps-indicator">
      <div class="step" 
           *ngFor="let step of [1,2,3,4,5]" 
           [class.active]="currentStep === step"
           [class.completed]="currentStep > step"
           (click)="goToStep(step)">
        <div class="step-circle">
          <span *ngIf="currentStep <= step">{{ step }}</span>
          <span *ngIf="currentStep > step" class="checkmark">‚úì</span>
        </div>
        <div class="step-label">
          <span *ngIf="step === 1">Basic Info</span>
          <span *ngIf="step === 2">Location</span>
          <span *ngIf="step === 3">Details</span>
          <span *ngIf="step === 4">Pricing</span>
          <span *ngIf="step === 5">Amenities</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Form -->
  <form [formGroup]="propertyForm" (ngSubmit)="onSubmit()" class="property-form">
    
    <!-- Step 1: Basic Information -->
    <div class="form-step" *ngIf="currentStep === 1">
      <h2>Basic Information</h2>
      <p class="step-description">Let's start with the basics about your property</p>

      <div class="form-group">
        <label for="title">Property Title <span class="required">*</span></label>
        <input 
          type="text" 
          id="title" 
          formControlName="title"
          placeholder="e.g., Cozy Apartment in Downtown"
          [class.error]="isFieldInvalid('title')">
        <div class="error-message" *ngIf="isFieldInvalid('title')">
          {{ getFieldError('title') }}
        </div>
        <div class="char-count">
          {{ propertyForm.get('title')?.value?.length || 0 }} / 200
        </div>
      </div>

      <div class="form-group">
        <label for="propertyType">Property Type <span class="required">*</span></label>
        <select 
          id="propertyType" 
          formControlName="propertyType"
          [class.error]="isFieldInvalid('propertyType')">
          <option value="">Select property type</option>
          <option *ngFor="let type of propertyTypes" [value]="type">
            {{ formatPropertyType(type) }}
          </option>
        </select>
        <div class="error-message" *ngIf="isFieldInvalid('propertyType')">
          {{ getFieldError('propertyType') }}
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description <span class="required">*</span></label>
        <textarea 
          id="description" 
          formControlName="description"
          rows="6"
          placeholder="Describe your property, highlight unique features, nearby attractions..."
          [class.error]="isFieldInvalid('description')"></textarea>
        <div class="error-message" *ngIf="isFieldInvalid('description')">
          {{ getFieldError('description') }}
        </div>
        <div class="char-count">
          {{ propertyForm.get('description')?.value?.length || 0 }} / 2000
        </div>
      </div>
    </div>

    <!-- Step 2: Location -->
    <div class="form-step" *ngIf="currentStep === 2">
      <h2>Location</h2>
      <p class="step-description">Where is your property located?</p>

      <div class="form-group">
        <label for="address">Street Address <span class="required">*</span></label>
        <input 
          type="text" 
          id="address" 
          formControlName="address"
          placeholder="123 Main Street"
          [class.error]="isFieldInvalid('address')">
        <div class="error-message" *ngIf="isFieldInvalid('address')">
          {{ getFieldError('address') }}
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="city">City <span class="required">*</span></label>
          <input 
            type="text" 
            id="city" 
            formControlName="city"
            placeholder="New York"
            [class.error]="isFieldInvalid('city')">
          <div class="error-message" *ngIf="isFieldInvalid('city')">
            {{ getFieldError('city') }}
          </div>
        </div>

        <div class="form-group">
          <label for="country">Country <span class="required">*</span></label>
          <input 
            type="text" 
            id="country" 
            formControlName="country"
            placeholder="United States"
            [class.error]="isFieldInvalid('country')">
          <div class="error-message" *ngIf="isFieldInvalid('country')">
            {{ getFieldError('country') }}
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="postalCode">Postal Code</label>
        <input 
          type="text" 
          id="postalCode" 
          formControlName="postalCode"
          placeholder="10001">
      </div>

      <div class="location-section">
        <label>Coordinates <span class="required">*</span></label>
        <div class="form-row">
          <div class="form-group">
            <input 
              type="number" 
              step="any"
              formControlName="latitude"
              placeholder="Latitude"
              [class.error]="isFieldInvalid('latitude')">
          </div>
          <div class="form-group">
            <input 
              type="number" 
              step="any"
              formControlName="longitude"
              placeholder="Longitude"
              [class.error]="isFieldInvalid('longitude')">
          </div>
        </div>
        <button type="button" class="btn-secondary" (click)="getCurrentLocation()">
          üìç Get Current Location
        </button>
      </div>
    </div>

    <!-- Step 3: Property Details -->
    <div class="form-step" *ngIf="currentStep === 3">
      <h2>Property Details</h2>
      <p class="step-description">Tell us about your property capacity</p>

      <div class="details-grid">
        <div class="form-group">
          <label for="numberOfBedrooms">Bedrooms <span class="required">*</span></label>
          <div class="number-input">
            <button type="button" 
                    (click)="propertyForm.patchValue({numberOfBedrooms: Math.max(1, propertyForm.get('numberOfBedrooms')!.value - 1)})">
              -
            </button>
            <input 
              type="number" 
              id="numberOfBedrooms" 
              formControlName="numberOfBedrooms"
              min="1"
              [class.error]="isFieldInvalid('numberOfBedrooms')">
            <button type="button" 
                    (click)="propertyForm.patchValue({numberOfBedrooms: propertyForm.get('numberOfBedrooms')!.value + 1})">
              +
            </button>
          </div>
        </div>

        <div class="form-group">
          <label for="numberOfBathrooms">Bathrooms <span class="required">*</span></label>
          <div class="number-input">
            <button type="button" 
                    (click)="propertyForm.patchValue({numberOfBathrooms: Math.max(1, propertyForm.get('numberOfBathrooms')!.value - 1)})">
              -
            </button>
            <input 
              type="number" 
              id="numberOfBathrooms" 
              formControlName="numberOfBathrooms"
              min="1"
              [class.error]="isFieldInvalid('numberOfBathrooms')">
            <button type="button" 
                    (click)="propertyForm.patchValue({numberOfBathrooms: propertyForm.get('numberOfBathrooms')!.value + 1})">
              +
            </button>
          </div>
        </div>

        <div class="form-group">
          <label for="maxGuests">Max Guests <span class="required">*</span></label>
          <div class="number-input">
            <button type="button" 
                    (click)="propertyForm.patchValue({maxGuests: Math.max(1, propertyForm.get('maxGuests')!.value - 1)})">
              -
            </button>
            <input 
              type="number" 
              id="maxGuests" 
              formControlName="maxGuests"
              min="1"
              [class.error]="isFieldInvalid('maxGuests')">
            <button type="button" 
                    (click)="propertyForm.patchValue({maxGuests: propertyForm.get('maxGuests')!.value + 1})">
              +
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 4: Pricing & Rules -->
    <div class="form-step" *ngIf="currentStep === 4">
      <h2>Pricing & House Rules</h2>
      <p class="step-description">Set your pricing and house rules</p>

      <div class="form-row">
        <div class="form-group">
          <label for="pricePerNight">Price per Night ($) <span class="required">*</span></label>
          <input 
            type="number" 
            id="pricePerNight" 
            formControlName="pricePerNight"
            min="1"
            placeholder="100"
            [class.error]="isFieldInvalid('pricePerNight')">
          <div class="error-message" *ngIf="isFieldInvalid('pricePerNight')">
            {{ getFieldError('pricePerNight') }}
          </div>
        </div>

        <div class="form-group">
          <label for="cleaningFee">Cleaning Fee ($)</label>
          <input 
            type="number" 
            id="cleaningFee" 
            formControlName="cleaningFee"
            min="0"
            placeholder="50">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="checkInTime">Check-in Time</label>
          <input 
            type="time" 
            id="checkInTime" 
            formControlName="checkInTime">
        </div>

        <div class="form-group">
          <label for="checkOutTime">Check-out Time</label>
          <input 
            type="time" 
            id="checkOutTime" 
            formControlName="checkOutTime">
        </div>
      </div>

      <div class="form-group">
        <label for="minimumStay">Minimum Stay (nights) <span class="required">*</span></label>
        <input 
          type="number" 
          id="minimumStay" 
          formControlName="minimumStay"
          min="1"
          placeholder="1"
          [class.error]="isFieldInvalid('minimumStay')">
        <div class="error-message" *ngIf="isFieldInvalid('minimumStay')">
          {{ getFieldError('minimumStay') }}
        </div>
      </div>

      <div class="form-group">
        <label for="houseRules">House Rules</label>
        <textarea 
          id="houseRules" 
          formControlName="houseRules"
          rows="4"
          placeholder="No smoking, No pets, Quiet hours after 10 PM..."></textarea>
      </div>
    </div>

    <!-- Step 5: Amenities & Images -->
    <div class="form-step" *ngIf="currentStep === 5">
      <h2>Amenities & Photos</h2>
      <p class="step-description">Add amenities and upload property photos</p>

      <!-- Amenities -->
      <div class="amenities-section">
        <h3>Select Amenities <span class="required">*</span></h3>
        
        <div *ngFor="let category of getUniqueCategories()" class="amenity-category">
          <h4>{{ category }}</h4>
          <div class="amenities-grid">
            <div 
              *ngFor="let amenity of getAmenitiesByCategory(category)"
              class="amenity-item"
              [class.selected]="isAmenitySelected(amenity.id)"
              (click)="toggleAmenity(amenity.id)">
              <span class="amenity-icon">{{ amenity.icon || '‚úì' }}</span>
              <span class="amenity-name">{{ amenity.name }}</span>
            </div>
          </div>
        </div>

        <div class="error-message" *ngIf="isFieldInvalid('amenityIds')">
          Please select at least one amenity
        </div>
      </div>

      <!-- Image Upload -->
      <div class="images-section">
        <h3>Property Photos</h3>
        <p class="helper-text">Upload at least one photo (Max 5MB per image)</p>
        
        <div class="upload-area">
          <input 
            type="file" 
            id="imageUpload" 
            multiple 
            accept="image/jpeg,image/jpg,image/png,image/webp"
            (change)="onFileSelected($event)"
            #fileInput>
          <label for="imageUpload" class="upload-label">
            <span class="upload-icon">üì∑</span>
            <span>Click to upload photos</span>
            <span class="upload-hint">or drag and drop</span>
          </label>
        </div>

        <div class="images-preview" *ngIf="imagesPreviews.length > 0">
          <div class="preview-item" *ngFor="let preview of imagesPreviews; let i = index">
            <img [src]="preview" [alt]="'Preview ' + (i + 1)">
            <button type="button" class="remove-btn" (click)="removeImage(i)">√ó</button>
            <span class="primary-badge" *ngIf="i === 0">Primary</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="form-actions">
      <button 
        type="button" 
        class="btn-secondary" 
        *ngIf="currentStep > 1"
        (click)="previousStep()">
        Previous
      </button>

      <button 
        type="button" 
        class="btn-primary" 
        *ngIf="currentStep < totalSteps"
        (click)="nextStep()">
        Next
      </button>

      <button 
        type="submit" 
        class="btn-primary btn-submit" 
        *ngIf="currentStep === totalSteps"
        [disabled]="isSubmitting">
        <span *ngIf="!isSubmitting">Create Property</span>
        <span *ngIf="isSubmitting">Creating...</span>
      </button>
    </div>
  </form>
</div>