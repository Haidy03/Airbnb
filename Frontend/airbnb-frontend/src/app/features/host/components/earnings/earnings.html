<div class="earnings-page" *ngIf="!isLoading(); else loadingTpl">
  
  <h1 class="page-title">Earnings</h1>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <h3>Total Earnings</h3>
      <p class="amount">EGP{{ data()?.totalEarnings | number:'1.0-2' }}</p>
    </div>
    <div class="stat-card">
      <h3>Paid this month</h3>
      <p class="amount">EGP{{ data()?.thisMonthEarnings | number:'1.0-2' }}</p>
    </div>
    <div class="stat-card pending">
      <h3>Expected</h3>
      <p class="amount">EGP{{ data()?.pendingPayouts | number:'1.0-2' }}</p>
    </div>
  </div>

  <!-- Simple CSS Bar Chart -->
  <div class="chart-section">
    <div class="section-header">
    <h2>Monthly earnings</h2>
      <div class="chart-nav" *ngIf="showScrollButtons()">
        <button class="nav-btn" (click)="scrollLeft()"><i class="bi bi-chevron-left"></i></button>
        <button class="nav-btn" (click)="scrollRight()"><i class="bi bi-chevron-right"></i></button>
      </div>
    </div>
    <div class="bar-chart-container" #chartScroll>
    <div class="bar-chart">
      <div class="bar-item" 
             *ngFor="let item of fullChartData()"
             (click)="selectMonth(item.month)"
             [class.active]="selectedMonth() === item.month"
             [class.empty]="item.amount === 0"> 

        <div class="bar-value" [style.height]="getBarHeight(item.amount)">
          <span class="tooltip">EGP{{ item.amount | number:'1.0-0' }}</span>
        </div>
        <span class="bar-label">{{ item.month }}</span>
      </div>
    </div>
  </div>
</div>
  <!-- Transactions Table -->
  <div class="transactions-section">
    <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>
      Recent transactions
      <span *ngIf="selectedMonth()" class="text-muted fs-6">({{ selectedMonth() }})</span>
    </h2>
    <button *ngIf="selectedMonth()" class="btn btn-link btn-sm" (click)="selectMonth(selectedMonth()!)">Clear filter</button>
    </div>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Status</th>
            <th>Guest</th>
            <th>Property / Experience/ Service</th>
            <th class="text-right">Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let trans of filteredTransactions()">
            <td>{{ trans.date | date:'mediumDate' }}</td>
     
            <td>
              <span class="type-badge" [class]="(trans.type || '').toLowerCase()">
                <i class="bi" 
                   [class.bi-house-door-fill]="trans.type === 'Home'"
                   [class.bi-balloon-heart-fill]="trans.type === 'Experience'"
                   [class.bi-bell-fill]="trans.type === 'Service'">
                </i>
                {{ trans.type || 'Unknown' }}
              </span>
            </td>

            <td>
              <span class="status-badge" [class]="(trans.status || '').toLowerCase()">
                {{ trans.status }}
              </span>
            </td>

            <td>{{ trans.guestName }}</td>
            <td>{{ trans.propertyTitle }}</td>
            <td class="text-right font-bold">EGP{{ trans.amount | number:'1.0-2' }}</td>
          </tr>
          <tr *ngIf="filteredTransactions().length === 0">
            <td colspan="6" class="text-center py-4 text-muted">
              No transactions found for this month.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<ng-template #loadingTpl>
  <div class="loading-screen">Loading earnings...</div>
</ng-template>