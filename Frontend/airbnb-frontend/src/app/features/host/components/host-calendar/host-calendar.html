<div class="calendar-page">
  
  <!-- Main Container -->
  <div class="calendar-container">
    
    <!-- Left Sidebar: Properties List -->
    <div class="properties-sidebar">
      <h3 class="sidebar-title">Your listings</h3>
      
      <div class="properties-list">
        <div 
          *ngFor="let property of properties()"
          class="property-item"
          [class.active]="selectedProperty()?.id === property.id"
          (click)="selectProperty(property)">
          
          <img 
            [src]="property.coverImage || property.images[0]?.url" 
            [alt]="property.title"
            class="property-thumb">
          
          <div class="property-details">
            <h4 class="property-name">{{ property.title }}</h4>
            <p class="property-location">{{ property.location.city }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Center: Calendar -->
    <div class="calendar-section">
      
      <!-- Calendar Header -->
      <div class="calendar-header">
        <button class="month-selector">
          <h1 class="month-title">{{ currentMonthYear() }}</h1>
          <span class="dropdown-icon">▼</span>
        </button>

        <div class="calendar-controls">
          <button class="nav-btn" (click)="previousMonth()" title="Previous month">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M10 12L6 8l4-4"/>
            </svg>
          </button>
          
          <button class="today-btn" (click)="goToToday()">
            Today
          </button>
          
          <button class="nav-btn" (click)="nextMonth()" title="Next month">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M6 4l4 4-4 4"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Selection Actions -->
      <div class="selection-actions" *ngIf="selectedDates().length > 0">
        <div class="selection-info">
          <span>{{ selectedDates().length }} dates selected</span>
          <button class="clear-btn" (click)="clearSelection()">Clear</button>
        </div>
        
        <div class="action-buttons">
          <button class="action-btn" (click)="openPriceModal()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 2C5.6 2 2 5.6 2 10s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 11h-2v-2h2v2zm0-4h-2V5h2v4z"/>
            </svg>
            Edit price
          </button>
          
          <button class="action-btn" (click)="openAvailabilityModal()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M2 10h16M10 2v16"/>
            </svg>
            Edit availability
          </button>
        </div>
      </div>

      <!-- Week Days Header -->
      <div class="weekdays-header">
        <div *ngFor="let day of weekDays" class="weekday-cell">
          {{ day }}
        </div>
      </div>

      <!-- Calendar Grid -->
      <div class="calendar-grid">
        <div 
          *ngFor="let day of calendarDays()"
          [class]="getDayClasses(day)"
          (click)="onDayClick(day, $event)">
          
          <!-- Day Number -->
          <div class="day-number">{{ day.dayNumber }}</div>
          
          <!-- Booking Badge -->
          <div class="booking-badge" *ngIf="day.hasBooking">
            <span class="badge-label">{{ day.guestName }}</span>
          </div>
          
          <!-- Check-in/out Indicators -->
          <div class="check-indicator check-in" *ngIf="day.isCheckIn">
            Check-in
          </div>
          <div class="check-indicator check-out" *ngIf="day.isCheckOut">
            Check-out
          </div>
          
          <!-- Price -->
          <div class="day-price" *ngIf="day.isCurrentMonth && !day.hasBooking">
            <span [class.custom-price]="day.originalPrice">
              {{ formatPrice(day.price) }}
            </span>
            <span class="original-price" *ngIf="day.originalPrice">
              {{ formatPrice(day.originalPrice) }}
            </span>
          </div>
          
          <!-- Blocked Indicator -->
          <div class="blocked-indicator" *ngIf="day.isBlocked">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6 0-1.3.4-2.5 1.1-3.5l8.4 8.4C10.5 13.6 9.3 14 8 14zm4.9-2.5L4.5 3.1C5.5 2.4 6.7 2 8 2c3.3 0 6 2.7 6 6 0 1.3-.4 2.5-1.1 3.5z"/>
            </svg>
          </div>
        </div>
      </div>

    </div>

    <!-- Right Sidebar: Settings Panel -->
    <div class="settings-panel">
      
      <!-- Price Settings -->
      <div class="settings-section">
        <div class="settings-header">
          <h3 class="settings-title">Price settings</h3>
          <button class="edit-btn" (click)="showSettingsModal.set(true)">
            Edit
          </button>
        </div>
        <div class="settings-items">
          <div class="settings-item">
            <span class="item-label">Base price</span>
            <span class="item-value">${{ settings().basePrice }} per night</span>
          </div>
          <div class="settings-item" *ngIf="settings().weekendPrice">
            <span class="item-label">Weekend price</span>
            <span class="item-value">${{ settings().weekendPrice }}</span>
          </div>
        </div>
      </div>

      <div class="settings-divider"></div>

      <!-- Availability Settings -->
      <div class="settings-section">
        <div class="settings-header">
          <h3 class="settings-title">Availability settings</h3>
          <button class="edit-btn" (click)="showSettingsModal.set(true)">
            Edit
          </button>
        </div>
        <div class="settings-items">
          <div class="settings-item">
            <span class="item-label">Length of stay</span>
            <span class="item-value">
              {{ settings().minimumNights }}–{{ settings().maximumNights }} nights
            </span>
          </div>
          <div class="settings-item">
            <span class="item-label">Advance notice</span>
            <span class="item-value">
              {{ settings().advanceNotice }} day{{ settings().advanceNotice !== 1 ? 's' : '' }}
            </span>
          </div>
          <div class="settings-item">
            <span class="item-label">Preparation time</span>
            <span class="item-value">
              {{ settings().preparationTime }} day{{ settings().preparationTime !== 1 ? 's' : '' }}
            </span>
          </div>
        </div>
      </div>

      <!-- Legend -->
      <!-- Removed as per user request -->

    </div>

  </div>

  <!-- Price Modal -->
  <div class="modal-overlay" *ngIf="showPriceModal()" (click)="showPriceModal.set(false)">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Edit Price</h2>
        <button class="close-btn" (click)="showPriceModal.set(false)">×</button>
      </div>
      
      <form [formGroup]="priceForm" (ngSubmit)="updatePricing()">
        <div class="modal-body">
          <p class="modal-description">
            Set a custom price for {{ selectedDates().length }} selected date(s)
          </p>
          
          <div class="form-group">
            <label>Price per night ($)</label>
            <input 
              type="number" 
              formControlName="price"
              min="1"
              placeholder="Enter price">
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="applyToWeekends">
              <span>Apply to weekend pricing</span>
            </label>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="showPriceModal.set(false)">
            Cancel
          </button>
          <button type="submit" class="btn-primary" [disabled]="priceForm.invalid">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Availability Modal -->
  <div class="modal-overlay" *ngIf="showAvailabilityModal()" (click)="showAvailabilityModal.set(false)">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Edit Availability</h2>
        <button class="close-btn" (click)="showAvailabilityModal.set(false)">×</button>
      </div>
      
      <form [formGroup]="availabilityForm" (ngSubmit)="updateAvailability()">
        <div class="modal-body">
          <p class="modal-description">
            Update availability for {{ selectedDates().length }} selected date(s)
          </p>
          
          <div class="form-group">
            <label>Status</label>
            <select formControlName="isAvailable">
              <option [value]="true">Available</option>
              <option [value]="false">Blocked</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Notes (optional)</label>
            <textarea 
              formControlName="notes"
              rows="3"
              placeholder="Add notes about this date..."></textarea>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="showAvailabilityModal.set(false)">
            Cancel
          </button>
          <button type="submit" class="btn-primary">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" *ngIf="showSettingsModal()" (click)="showSettingsModal.set(false)">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Calendar Settings</h2>
        <button class="close-btn" (click)="showSettingsModal.set(false)">×</button>
      </div>
      
      <form [formGroup]="settingsForm" (ngSubmit)="saveSettings()">
        <div class="modal-body">
          <h3 class="section-title">Pricing</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Base price per night ($)</label>
              <input 
                type="number" 
                formControlName="basePrice"
                min="1"
                placeholder="50">
            </div>
            
            <div class="form-group">
              <label>Weekend price ($)</label>
              <input 
                type="number" 
                formControlName="weekendPrice"
                min="0"
                placeholder="60">
            </div>
          </div>
          
          <h3 class="section-title">Availability</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Minimum nights</label>
              <input 
                type="number" 
                formControlName="minimumNights"
                min="1">
            </div>
            
            <div class="form-group">
              <label>Maximum nights</label>
              <input 
                type="number" 
                formControlName="maximumNights"
                min="1">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Advance notice (days)</label>
              <input 
                type="number" 
                formControlName="advanceNotice"
                min="0">
            </div>
            
            <div class="form-group">
              <label>Preparation time (days)</label>
              <input 
                type="number" 
                formControlName="preparationTime"
                min="0">
            </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="showSettingsModal.set(false)">
            Cancel
          </button>
          <button type="submit" class="btn-primary" [disabled]="settingsForm.invalid">
            Save Settings
          </button>
        </div>
      </form>
    </div>
  </div>

</div>