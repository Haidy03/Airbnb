<div class="editor-layout" *ngIf="!isLoading(); else loadingTpl">

  <!-- Header -->
  <header class="editor-header">
    <div class="header-start">
      <button class="btn-back" routerLink="/host/properties">
        <svg viewBox="0 0 32 32" width="16" height="16" stroke="currentColor" stroke-width="3"><path d="M20 28 8.7 16.7a1 1 0 0 1 0-1.4L20 4" fill="none" /></svg>
      </button>
      <h1 class="header-title">Listing editor</h1>
    </div>
    <div class="header-center">
       <div class="tabs-pill">
         <button class="tab active">Your space</button>
         <button class="tab">Arrival guide</button>
       </div>
    </div>
    <div class="header-end">
      <button class="btn-view">View listing</button>
    </div>
  </header>

  <div class="editor-body">
    
    <!-- ================= LEFT SIDEBAR (Navigation) ================= -->
    <aside class="editor-sidebar">
      
      <!-- Photos -->
      <div class="nav-card" [class.active]="activeSection() === 'photos'" (click)="setActiveSection('photos')">
        <div class="nav-header"> <span class="nav-label">Photos</span> </div>
        <div class="nav-content photo-preview">
          <img [src]="getCoverImage()" alt="Cover">
          <span>{{ property()?.images?.length }} photos</span>
        </div>
      </div>

      <!-- Title -->
      <div class="nav-card" [class.active]="activeSection() === 'title'" (click)="setActiveSection('title')">
        <div class="nav-header"> <span class="nav-label">Title</span> </div>
        <div class="nav-content text-truncate">{{ property()?.title }}</div>
      </div>

      <!-- Property Type (Matches Screenshot) -->
      <div class="nav-card" [class.active]="activeSection() === 'propertyType'" (click)="setActiveSection('propertyType')">
        <div class="nav-header"> <span class="nav-label">Property type</span> </div>
        <div class="nav-content">{{ property()?.roomType }} · {{ property()?.propertyType }}</div>
      </div>

      <!-- Description -->
      <div class="nav-card" [class.active]="activeSection() === 'description'" (click)="setActiveSection('description')">
        <div class="nav-header"> <span class="nav-label">Description</span> </div>
        <div class="nav-content text-truncate">{{ property()?.description }}</div>
      </div>

      <!-- Pricing -->
      <div class="nav-card" [class.active]="activeSection() === 'pricing'" (click)="setActiveSection('pricing')">
        <div class="nav-header"> <span class="nav-label">Pricing</span> </div>
        <div class="nav-content">${{ property()?.pricing?.basePrice }} per night</div>
      </div>

      <!-- Location -->
      <div class="nav-card" [class.active]="activeSection() === 'location'" (click)="setActiveSection('location')">
        <div class="nav-header"> <span class="nav-label">Location</span> </div>
        <div class="nav-content text-truncate">{{ property()?.location?.address }}</div>
      </div>

      <!-- Amenities -->
      <div class="nav-card" [class.active]="activeSection() === 'amenities'" (click)="setActiveSection('amenities')">
        <div class="nav-header"> <span class="nav-label">Amenities</span> </div>
        <div class="nav-content">{{ property()?.amenities?.length }} amenities</div>
      </div>

    </aside>

    <!-- ================= RIGHT CONTENT (Forms) ================= -->
    <main class="editor-main">
      
      <!-- 1. PROPERTY TYPE EDITOR (Like Screenshot) -->
      <section *ngIf="activeSection() === 'propertyType'" class="editor-section">
        <h2 class="section-title">Property type</h2>
        
        <div class="form-group">
          <label>Property type</label>
          <div class="select-wrapper">
            <select [(ngModel)]="tempPropertyType">
              <option *ngFor="let type of propertyTypesList" [value]="type">{{ type }}</option>
            </select>
            <span class="chevron">▼</span>
          </div>
        </div>

        <div class="form-group">
          <label>Listing type</label>
          <div class="select-wrapper">
            <select [(ngModel)]="tempRoomType">
              <option *ngFor="let room of roomTypesList" [value]="room">{{ room }}</option>
            </select>
            <span class="chevron">▼</span>
          </div>
          <p class="input-hint">Guests have their own room for sleeping. Other areas can be shared.</p>
        </div>
      </section>

      <!-- 2. TITLE EDITOR -->
      <section *ngIf="activeSection() === 'title'" class="editor-section">
        <h2 class="section-title">Title</h2>
        <div class="form-group">
          <textarea class="airbnb-input large" rows="3" maxlength="50" [(ngModel)]="tempTitle"></textarea>
          <div class="char-count">{{ tempTitle().length }}/50</div>
        </div>
      </section>

      <!-- 3. DESCRIPTION EDITOR -->
      <section *ngIf="activeSection() === 'description'" class="editor-section">
        <h2 class="section-title">Description</h2>
        <div class="form-group">
          <textarea class="airbnb-input" rows="10" maxlength="500" [(ngModel)]="tempDescription"></textarea>
          <div class="char-count">{{ tempDescription().length }}/500</div>
        </div>
      </section>

      <!-- 4. PRICING EDITOR -->
      <section *ngIf="activeSection() === 'pricing'" class="editor-section">
        <h2 class="section-title">Pricing</h2>
        <div class="form-group">
          <label>Base price per night</label>
          <div class="price-input-wrapper">
            <span class="currency">$</span>
            <input type="number" class="airbnb-input price" [(ngModel)]="tempPrice">
          </div>
        </div>
      </section>

      <!-- 5. LOCATION EDITOR -->
      <section *ngIf="activeSection() === 'location'" class="editor-section">
        <h2 class="section-title">Location</h2>
        <div class="form-group">
          <label>Street Address</label>
          <input type="text" class="airbnb-input" [(ngModel)]="tempLocation().address">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input type="text" class="airbnb-input" [(ngModel)]="tempLocation().city">
          </div>
          <div class="form-group">
            <label>Country</label>
            <input type="text" class="airbnb-input" [(ngModel)]="tempLocation().country">
          </div>
        </div>
      </section>

      <!-- 6. AMENITIES EDITOR -->
      <section *ngIf="activeSection() === 'amenities'" class="editor-section">
        <h2 class="section-title">Amenities</h2>
        <div class="amenities-list">
          <div *ngFor="let amenity of availableAmenities" class="amenity-item">
            <label class="checkbox-label">
              <input type="checkbox" 
                     [checked]="tempAmenities().includes(amenity.id)"
                     (change)="toggleAmenity(amenity.id)">
              <span>{{ amenity.name }}</span>
            </label>
          </div>
        </div>
      </section>

      <!-- PHOTOS PLACEHOLDER -->
      <section *ngIf="activeSection() === 'photos'" class="editor-section">
        <h2 class="section-title">Photos</h2>
        <div class="photos-grid">
          <div *ngFor="let img of property()?.images" class="photo-card">
            <img [src]="img.url" alt="Prop">
          </div>
        </div>
        <button class="btn-secondary" style="margin-top: 20px;">Photo Tour</button>
      </section>

      <!-- SAVE BUTTON (Sticky Bottom) -->
      <div class="save-bar">
        <button class="btn-black" (click)="saveChanges()">Save</button>
      </div>

    </main>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="loading-screen"><div class="spinner"></div></div>
</ng-template>