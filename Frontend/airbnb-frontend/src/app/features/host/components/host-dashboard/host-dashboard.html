<div class="today-page">
  
  <!-- Tab Navigation -->
 <div class="tab-navigation">
    <button 
      class="tab-button"
      [class.active]="activeTab() === 'today'"
      (click)="setActiveTab('today')">
      Today
    </button>
    <button 
      class="tab-button"
      [class.active]="activeTab() === 'upcoming'"
      (click)="setActiveTab('upcoming')">
      Upcoming
    </button>
     <button 
      class="tab-button"
      [class.active]="activeTab() === 'past'"
      (click)="setActiveTab('past')">
      Past
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
  </div>

  <!-- ==================== TODAY TAB ==================== -->
  <div *ngIf="!loading() && activeTab() === 'today'" class="tab-content">
    
    <div *ngIf="todayBookings().length === 0" class="empty-state">
      <div class="empty-illustration">
        <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
          <rect x="30" y="25" width="60" height="70" rx="3" fill="#E0E0E0"/>
          <rect x="35" y="30" width="50" height="60" rx="2" fill="#F5F5F5"/>
          <line x1="45" y1="40" x2="75" y2="40" stroke="#BDBDBD" stroke-width="2"/>
          <line x1="45" y1="50" x2="75" y2="50" stroke="#BDBDBD" stroke-width="2"/>
          <line x1="45" y1="60" x2="70" y2="60" stroke="#BDBDBD" stroke-width="2"/>
          <path d="M60 30 L65 35 L60 40 L55 35 Z" fill="#FF385C"/>
        </svg>
      </div>
      <h2 class="empty-title">You don't have any reservations today</h2>
      <p class="empty-description">To get booked, you'll need to complete and publish your listing.</p>
      <button class="complete-listing-btn" (click)="completeYourListing()">Complete your listing</button>
    </div>

    <div *ngIf="todayBookings().length > 0" class="bookings-list">
      <div *ngFor="let booking of todayBookings()" class="booking-card">
        
        <div class="booking-image">
          <img [src]="booking.propertyImage" [alt]="booking.propertyTitle" onerror="this.src='/assets/images/placeholder-property.jpg'">
        </div>

        <div class="booking-info">
          <div class="booking-header">
             <span class="type-badge" [class]="booking.type?.toLowerCase()">
              {{ booking.type }}
            </span>
            <span class="event-badge" 
                  [class.status-confirmed]="booking.status === 'Confirmed'"
                  [class.status-pending]="booking.status === 'Pending'"
                  [class.status-cancelled]="booking.status === 'Cancelled'"
                  [class.status-awaiting]="booking.status === 'AwaitingPayment'">
              {{ booking.status }}
            </span>
            <span class="booking-time">{{ getCheckInOutTime(booking) }}</span>
          </div>
          <h3 class="guest-name">{{ booking.guestName }}</h3>
          <p class="property-title">{{ booking.propertyTitle }}</p>
          <p class="booking-dates">{{ formatDateRange(booking.checkInDate, booking.checkOutDate) }}</p>
          <p class="guest-count">{{ booking.numberOfGuests }} {{ booking.numberOfGuests === 1 ? 'guest' : 'guests' }}</p>
        </div>

        <div class="booking-actions">
          <button class="action-btn" 
            [routerLink]="['/host/messages']" 
            [queryParams]="{ guestId: booking.guestId, propertyId: booking.propertyId }">
            <span class="btn-icon">ðŸ’¬</span> Message
          </button>
          <button class="action-btn secondary" (click)="viewDetails(booking)">View details</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== UPCOMING TAB ==================== -->
  <div *ngIf="!loading() && activeTab() === 'upcoming'" class="tab-content">
    
    <div *ngIf="upcomingBookings().length === 0" class="empty-state">
      <div class="empty-illustration">
        <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
          <rect x="30" y="25" width="60" height="70" rx="3" fill="#E0E0E0"/>
          <rect x="35" y="30" width="50" height="60" rx="2" fill="#F5F5F5"/>
          <line x1="45" y1="40" x2="75" y2="40" stroke="#BDBDBD" stroke-width="2"/>
          <line x1="45" y1="50" x2="75" y2="50" stroke="#BDBDBD" stroke-width="2"/>
          <line x1="45" y1="60" x2="70" y2="60" stroke="#BDBDBD" stroke-width="2"/>
          <path d="M60 30 L65 35 L60 40 L55 35 Z" fill="#FF385C"/>
        </svg>
      </div>
      <h2 class="empty-title">You don't have any upcoming reservations</h2>
      <p class="empty-description">To get booked, you'll need to complete and publish your listing.</p>
      <button class="complete-listing-btn" (click)="completeYourListing()">Complete your listing</button>
    </div>

    <div *ngIf="upcomingBookings().length > 0" class="bookings-list">
      <div *ngFor="let booking of upcomingBookings()" class="booking-card">
        
        <div class="booking-image">
          <img [src]="booking.propertyImage" [alt]="booking.propertyTitle" onerror="this.src='assets/images/placeholder-property.jpg'">
        </div>

        <div class="booking-info">
          <div class="booking-header">
             <span class="type-badge" [class]="booking.type?.toLowerCase()">
              {{ booking.type }}
            </span>
            
            <span class="event-badge" 
                  [class.status-confirmed]="booking.status === 'Confirmed'"
                  [class.status-pending]="booking.status === 'Pending'"
                  [class.status-cancelled]="booking.status === 'Cancelled'"
                  [class.status-awaiting]="booking.status === 'AwaitingPayment'">
              {{ booking.status }}
            </span>
            <span class="booking-time">Check-in: {{ formatDate(booking.checkInDate) }}</span>
          </div>

          <h3 class="guest-name">{{ booking.guestName }}</h3>
          <p class="property-title">{{ booking.propertyTitle }}</p>
          <p class="booking-dates">{{ formatDateRange(booking.checkInDate, booking.checkOutDate) }}</p>
          <p class="guest-count">{{ booking.numberOfGuests }} {{ booking.numberOfGuests === 1 ? 'guest' : 'guests' }}</p>
        </div>

        <div class="booking-actions">
          <button class="action-btn" 
            (click)="openChat(booking)">
            <span class="btn-icon">ðŸ’¬</span> Message
          </button>
          <button class="action-btn secondary" (click)="viewDetails(booking)">View details</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== âœ… PAST TAB (NEW) ==================== -->
  <div *ngIf="!loading() && activeTab() === 'past'" class="tab-content">
    
    <div *ngIf="pastBookings().length === 0" class="empty-state">
      
       <div class="empty-illustration">
        <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#DDDDDD" stroke-width="1">
           <circle cx="12" cy="12" r="10"></circle>
           <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
      </div>
      <h2 class="empty-title">No past reservations</h2>
      <p class="empty-description">You haven't hosted any guests yet.</p>
    </div>

    <div *ngIf="pastBookings().length > 0" class="bookings-list">
      <div *ngFor="let booking of pastBookings()" class="booking-card past">
        
        <div class="booking-image">
          <img [src]="booking.propertyImage" [alt]="booking.propertyTitle" onerror="this.src='assets/images/placeholder-property.jpg'">
          
          <!-- <div style="position:absolute; inset:0; background: rgba(255,255,255,0.1);"></div> -->
        </div>

        <div class="booking-info">
          <div class="booking-header">
             <span class="type-badge" [class]="booking.type?.toLowerCase()">{{ booking.type }}</span>
             <span class="event-badge" [class]="'status-' + booking.status.toLowerCase()">{{ booking.status }}</span>
             <span class="booking-time text-muted">Ended on {{ formatDate(booking.checkOutDate) }}</span>
          </div>

          <h3 class="guest-name">{{ booking.guestName }}</h3>
          <p class="property-title">{{ booking.propertyTitle }}</p>
          <p class="booking-dates text-muted">{{ formatDateRange(booking.checkInDate, booking.checkOutDate) }}</p>
        </div>

        <div class="booking-actions">
          <button class="action-btn" (click)="openChat(booking)">
            <span class="btn-icon">ðŸ’¬</span> Message
          </button>
          <button class="action-btn secondary" (click)="viewDetails(booking)">Details</button>
        </div>
      </div>
    </div>
  </div>
</div>