<header class="header">
  <div class="logo" [routerLink]="['/']">
    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <path d="M16 1c-5.5 0-10 4.5-10 10 0 8 10 20 10 20s10-12 10-20c0-5.5-4.5-10-10-10zm0 13.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z"/>
    </svg>
  </div>
  <div class="header-actions">
    <button class="btn-secondary" (click)="showQuestionsModal()">Questions?</button>
    <button class="btn-secondary outlined" (click)="saveAndExit()">Save & exit</button>
  </div>
</header>

<main class="main-content">
  <div class="content-container">
    
    <div class="step-header">
      <h1 class="main-title">Add some photos of your house</h1>
      <p class="step-description">
        You'll need 5 photos to get started. You can add more or make changes later.
      </p>
    </div>

    <!-- Upload Box -->
    <div class="upload-container">
      <div 
        class="upload-box"
        [class.dragging]="isDragging()"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)">
        
        <!-- ✅ 1. صورة كاميرا 3D أفضل -->
        <div class="camera-illustration">
          <img src="https://cdn-icons-png.flaticon.com/512/2983/2983067.png" alt="Camera">
        </div>

        <p class="drag-text">Drag and drop photos here</p>
        <p class="or-text">or</p>

        <label class="add-photos-btn">
          Upload photos
          <input 
            type="file" 
            multiple 
            accept="image/jpeg,image/jpg,image/png,image/webp"
            (change)="onFileSelected($event)"
            hidden>
        </label>

        <!-- ✅ 2. التعليمات المطلوبة -->
        <p class="upload-hint">Choose at least 5 photos</p>
        <p class="upload-formats">JPG, PNG or WebP up to 5MB</p>
        
      </div>
    </div>

    <!-- Photos Gallery -->
    <div class="photos-gallery" *ngIf="uploadedImages().length > 0">
         <div class="gallery-header">
            <h2 class="gallery-title">Your Photos <span class="photo-count">{{ uploadedImages().length }}</span></h2>
         </div>
         
         <div class="photos-grid">
            <div class="photo-card" *ngFor="let image of uploadedImages(); let i = index">
                <div class="photo-image-wrapper">
                    <img [src]="image.preview" class="photo-image">
                    
                    <!-- Loading Overlay -->
                    <div class="loading-overlay" *ngIf="!image.uploaded && image.progress < 100">
                      <div class="spinner"></div>
                    </div>

                    <!-- ✅ 3. أزرار التحكم (Delete & Set Primary) -->
                    <div class="card-actions">
                      <!-- زر الحذف (دائماً موجود) -->
                      <button class="icon-action-btn delete-btn" (click)="removeImage(image.id, $event)" title="Delete photo">
                        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M28 6h-6V2.996c0-.55-.446-1.004-.996-1.004H10.996A.997.997 0 0 0 10 2.996V6H4v2h2v20.996c0 .55.446 1.004.996 1.004h18.008a.997.997 0 0 0 .996-1.004V8h2V6zm-4 22H8V8h16v20zM12 2.996h8V6h-8V2.996z" fill="currentColor"/></svg>
                      </button>

                      <!-- خيارات الصورة الأساسية -->
                      <div class="primary-status">
                        <!-- إذا كانت الأساسية: يظهر Badge -->
                        <span class="cover-badge" *ngIf="image.isPrimary">Cover Photo</span>
                        
                        <!-- إذا لم تكن الأساسية: يظهر خيار تعيينها -->
                        <div class="menu-trigger" *ngIf="!image.isPrimary">
                           <button class="text-action-btn" (click)="setPrimary(image.id, $event)">Set as cover</button>
                        </div>
                      </div>
                    </div>

                </div>
            </div>
         </div>
    </div>

  </div>
</main>

<footer class="footer">
  <div class="progress-bar" style="width: 60%"></div>
  <button class="btn-back" (click)="goBack()">Back</button>
  <button class="btn-next" [disabled]="!canProceed() || isLoading()" (click)="goNext()">Next</button>
</footer>