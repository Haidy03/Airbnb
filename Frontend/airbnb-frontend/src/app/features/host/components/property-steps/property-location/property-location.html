<header class="header">
  <div class="logo" [routerLink]="['/']">
    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <path d="M16 1c-5.5 0-10 4.5-10 10 0 8 10 20 10 20s10-12 10-20c0-5.5-4.5-10-10-10zm0 13.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z"/>
    </svg>
  </div>
  <div class="header-actions">
    <button class="btn-secondary" (click)="showQuestionsModal()">
      Questions?
    </button>
    <button class="btn-primary" (click)="saveAndExit()">
      Save & exit
    </button>
  </div>
</header>

<main class="main-content">
  <div class="content-container">
    <!-- Step Title -->
    <div class="step-header">
      <h1 class="main-title">Where's your place located?</h1>
      <p class="step-description">
        Your address is only shared with guests after they've made a reservation.
      </p>
    </div>

    <!-- Location Form -->
    <form [formGroup]="locationForm" class="location-form">
      
      <!-- Country -->
      <div class="form-group">
        <label for="country">Country/Region <span class="required">*</span></label>
        <div class="autocomplete-wrapper">
          <input 
            type="text" 
            id="country" 
            formControlName="country"
            placeholder="Select a country"
            autocomplete="off"
            [class.error]="isFieldInvalid('country')">
          
          <!-- Country Suggestions Dropdown -->
          <div class="suggestions-dropdown" *ngIf="filteredCountries().length > 0">
            <button 
              *ngFor="let country of filteredCountries()"
              type="button"
              class="suggestion-item"
              (click)="selectCountry(country)">
              {{ country }}
            </button>
          </div>
        </div>
        <div class="error-message" *ngIf="isFieldInvalid('country')">
          {{ getFieldError('country') }}
        </div>
      </div>

      <!-- Street Address -->
      <div class="form-group">
        <label for="address">Street Address <span class="required">*</span></label>
        <input 
          type="text" 
          id="address" 
          formControlName="address"
          placeholder="e.g., 123 Main Street, Apartment 4B"
          [class.error]="isFieldInvalid('address')">
        <div class="error-message" *ngIf="isFieldInvalid('address')">
          {{ getFieldError('address') }}
        </div>
      </div>

      <!-- City & State (2 columns) -->
      <div class="form-row">
        <div class="form-group">
          <label for="city">City <span class="required">*</span></label>
          <input 
            type="text" 
            id="city" 
            formControlName="city"
            placeholder="e.g., New York"
            [class.error]="isFieldInvalid('city')">
          <div class="error-message" *ngIf="isFieldInvalid('city')">
            {{ getFieldError('city') }}
          </div>
        </div>

        <div class="form-group">
          <label for="state">State / Province</label>
          <input 
            type="text" 
            id="state" 
            formControlName="state"
            placeholder="e.g., New York">
        </div>
      </div>

      <!-- Postal Code -->
      <div class="form-group">
        <label for="postalCode">Postal Code</label>
        <input 
          type="text" 
          id="postalCode" 
          formControlName="postalCode"
          placeholder="e.g., 10001"
          [class.error]="isFieldInvalid('postalCode')">
        <div class="error-message" *ngIf="isFieldInvalid('postalCode')">
          {{ getFieldError('postalCode') }}
        </div>
      </div>

      <!-- Divider -->
      <div class="section-divider">
        <span class="divider-text">Pin your location</span>
      </div>

      <!-- Location Actions -->
      <div class="location-actions">
        <button 
          type="button" 
          class="btn-location"
          (click)="getCurrentLocation()"
          [disabled]="isGettingLocation()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 0C6.13 0 3 3.13 3 7c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
          </svg>
          <span *ngIf="!isGettingLocation()">Use current location</span>
          <span *ngIf="isGettingLocation()">Getting location...</span>
        </button>

        <button 
          type="button" 
          class="btn-location"
          (click)="geocodeAddress()"
          [disabled]="isLoading()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M9 0C4.03 0 0 4.03 0 9s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9zm0 16c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zm1-11H8v4l3.5 2.1.8-1.3-2.3-1.4V5z"/>
          </svg>
          <span *ngIf="!isLoading()">Find on map</span>
          <span *ngIf="isLoading()">Searching...</span>
        </button>
      </div>

      <!-- Coordinates (Advanced) -->
      <div class="coordinates-section">
        <div class="coordinates-header" (click)="showMap.set(!showMap())">
          <span class="coordinates-title">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0C5.79 0 4 1.79 4 4c0 3 4 8 4 8s4-5 4-8c0-2.21-1.79-4-4-4zm0 5.5c-.83 0-1.5-.67-1.5-1.5S7.17 2.5 8 2.5s1.5.67 1.5 1.5S8.83 5.5 8 5.5z"/>
            </svg>
            Coordinates
          </span>
          <span class="coordinates-toggle">
            {{ showMap() ? '‚ñ≤' : '‚ñº' }}
          </span>
        </div>

        <div class="coordinates-content" *ngIf="showMap()">
          <p class="coordinates-description">
            Fine-tune your pin location. The map shows the approximate area based on your address.
          </p>

          <div class="form-row">
            <div class="form-group">
              <label for="latitude">Latitude</label>
              <input 
                type="number" 
                id="latitude" 
                step="any"
                formControlName="latitude"
                placeholder="0.000000"
                (blur)="validateCoordinates()"
                [class.error]="isFieldInvalid('latitude')">
              <div class="error-message" *ngIf="isFieldInvalid('latitude')">
                {{ getFieldError('latitude') }}
              </div>
            </div>

            <div class="form-group">
              <label for="longitude">Longitude</label>
              <input 
                type="number" 
                id="longitude" 
                step="any"
                formControlName="longitude"
                placeholder="0.000000"
                (blur)="validateCoordinates()"
                [class.error]="isFieldInvalid('longitude')">
              <div class="error-message" *ngIf="isFieldInvalid('longitude')">
                {{ getFieldError('longitude') }}
              </div>
            </div>
          </div>

          <!-- Simple Map Preview (if coordinates are set) -->
          <div class="map-preview" *ngIf="locationForm.get('latitude')?.value && locationForm.get('longitude')?.value">
            <div class="map-placeholder">
              <div class="map-pin">üìç</div>
              <p class="map-coordinates">
                {{ locationForm.get('latitude')?.value | number:'1.4-4' }}, 
                {{ locationForm.get('longitude')?.value | number:'1.4-4' }}
              </p>
              <a 
                [href]="'https://www.google.com/maps?q=' + locationForm.get('latitude')?.value + ',' + locationForm.get('longitude')?.value" 
                target="_blank"
                class="map-link">
                Open in Google Maps ‚Üí
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Privacy Note -->
      <div class="privacy-note">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-6h2v6zm0-8H9V5h2v2z"/>
        </svg>
        <div class="privacy-text">
          <strong>Your privacy matters</strong>
          <p>Your exact address is only shared with guests after they book. Until then, we only show the general area on the map.</p>
        </div>
      </div>

    </form>
  </div>
</main>

<footer class="footer">
  <div class="progress-bar" style="width: 30%"></div>
  <button class="btn-back" (click)="goBack()">Back</button>
  <button 
    class="btn-next" 
    [disabled]="!isFormValid()"
    (click)="goNext()">
    Next
  </button>
</footer>