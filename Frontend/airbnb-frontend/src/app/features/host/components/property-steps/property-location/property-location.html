<div class="location-page">
  
  <!-- Header -->
  <header class="header">
    <div class="logo" [routerLink]="['/']">
      <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <path d="M16 1c-5.5 0-10 4.5-10 10 0 8 10 20 10 20s10-12 10-20c0-5.5-4.5-10-10-10zm0 13.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z"/>
      </svg>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="showQuestionsModal()">
        Questions?
      </button>
      <button class="btn-primary" (click)="saveAndExit()">
        Save & exit
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Left Side: Title -->
    <div class="content-left">
      <h1 class="main-title">Where's your place located?</h1>
      <p class="subtitle">Your address is only shared with guests after they've made a reservation.</p>
    </div>

    <!-- Right Side: Map -->
    <div class="content-right">
      
      <!-- Map Container -->
      <div class="map-container">
        <!-- Embedded Map (using Leaflet or Google Maps) -->
        
         <div #mapContainer class="map-wrapper"></div>

          <!-- Default Map (if no location selected) -->
          <div class="map-placeholder" *ngIf="!markerPosition()">
            <div class="map-placeholder-icon">üìç</div>
            <p>Select your location</p>
          </div>
        </div>

        <!-- Search Overlay -->
        <div class="search-overlay">
          <form [formGroup]="locationForm" class="search-form">
           
            <!-- Search Input -->
            <div class="search-input-wrapper">
              <div class="search-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 0C5.24 0 3 2.24 3 5c0 3.75 5 11 5 11s5-7.25 5-11c0-2.76-2.24-5-5-5zm0 7c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                </svg>
              </div>
              <input 
                type="text" 
                formControlName="searchAddress"
                placeholder="Enter your address"
                class="search-input"
                autocomplete="off">
              
              <!-- Clear Button -->
              <button 
                *ngIf="locationForm.get('searchAddress')?.value"
                type="button"
                class="clear-btn"
                (click)="locationForm.patchValue({ searchAddress: '' }); addressSuggestions.set([])">
                √ó
              </button>
            </div>

            <!-- Address Suggestions Dropdown -->
            <div class="suggestions-list" *ngIf="addressSuggestions().length > 0">
              <button
                *ngFor="let suggestion of addressSuggestions()"
                type="button"
                class="suggestion-item"
                (click)="selectAddress(suggestion)">
                <div class="suggestion-icon">üìç</div>
                <div class="suggestion-text">
                  <div class="suggestion-main">{{ suggestion.display_name }}</div>
                </div>
              </button>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button 
                type="button"
                class="action-btn"
                (click)="useCurrentLocation()"
                [disabled]="isGettingLocation()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 4V2M10 18v-2M16 10h2M2 10h2M15.07 4.93l1.41-1.41M3.52 16.48l1.41-1.41M4.93 4.93L3.52 3.52M16.48 16.48l-1.41-1.41M14 10a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <span *ngIf="!isGettingLocation()">Use my current location</span>
                <span *ngIf="isGettingLocation()">Getting location...</span>
              </button>

              <button 
                type="button"
                class="action-btn"
                (click)="toggleManualEntry()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                </svg>
                <span>Enter address manually</span>
              </button>
            </div>

          </form>
        </div>

      </div>

  

  </main>

  <!-- Manual Entry Modal -->
  <div class="modal-overlay" *ngIf="showManualEntry()" (click)="showManualEntry.set(false)">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Enter your address</h2>
        <button class="modal-close" (click)="showManualEntry.set(false)">√ó</button>
      </div>
      
      <form [formGroup]="locationForm" class="modal-form">
        <div class="modal-body">
          
          <div class="form-group">
            <label>Street address</label>
            <input 
              type="text" 
              formControlName="address"
              placeholder="e.g., 123 Main Street">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input 
                type="text" 
                formControlName="city"
                placeholder="e.g., Cairo">
            </div>

            <div class="form-group">
              <label>State / Province</label>
              <input 
                type="text" 
                formControlName="state"
                placeholder="Optional">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Country</label>
              <input 
                type="text" 
                formControlName="country"
                placeholder="e.g., Egypt">
            </div>

            <div class="form-group">
              <label>Postal code</label>
              <input 
                type="text" 
                formControlName="postalCode"
                placeholder="Optional">
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button 
            type="button" 
            class="btn-secondary"
            (click)="showManualEntry.set(false)">
            Cancel
          </button>
          <button 
            type="button" 
            class="btn-primary"
            (click)="closeManualEntry()">
            Confirm
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="progress-bar" style="width: 30%"></div>
    <button class="btn-back" (click)="goBack()">Back</button>
    <button 
      class="btn-next" 
      [disabled]="!isFormValid()"
      (click)="goNext()">
      Next
    </button>
  </footer>

</div>