<div class="main">
  <div class="container-fluid">
    <section class="content">
      @if (user(); as currentUser) {
        
        <div class="content-header">
          <h2>About me</h2>
          <button (click)="onEdit()" class="edit-btn">
            Edit
          </button>
        </div>

        <div class="profile-card">
          
          <!-- LEFT SIDE: Profile Info -->
          <div class="profile-info">
            
            <!-- Avatar Section (Merged Logic) -->
            <div class="profile-avatar mb-6">
              <!-- 1. Check profileDetails first (contains the timestamp fix for caching) -->
              @if (profileDetails?.profileImage) {
                <img [src]="profileDetails?.profileImage" 
                     [alt]="currentUser.firstName" 
                     style="width:100%; height:100%; object-fit:cover; border-radius:50%;">
              } 
              <!-- 2. Fallback to currentUser (from Header) -->
              @else if (currentUser.profilePicture) {
                <img [src]="currentUser.profilePicture" 
                     [alt]="currentUser.firstName" 
                     style="width:100%; height:100%; object-fit:cover; border-radius:50%;">
              }
              <!-- 3. Placeholder Initials -->
              @else {
                <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:white; font-size:48px;">
                  {{ currentUser.firstName?.charAt(0) | uppercase }}
                </div>
              }
            </div>

            <h3 class="profile-name">
              {{ profileDetails?.firstName || currentUser.firstName || 'User' }} 
              {{ profileDetails?.lastName || currentUser.lastName || '' }}
            </h3>
          </div>

          <!-- RIGHT SIDE: Details & Grid (Kept from HEAD) -->
          <div class="complete-profile" style="align-items: flex-start; justify-content: flex-start; overflow-y: auto;">
            
            <!-- 1. The About Me Text -->
            <div *ngIf="profileDetails?.aboutMe" style="margin-bottom: 24px; font-size: 16px; line-height: 1.5;">
              {{ profileDetails?.aboutMe }}
            </div>

            <!-- 2. The Facts Grid -->
            <div style="display: grid; grid-template-columns: 1fr; gap: 16px; width: 100%;">
              <ng-container *ngFor="let item of displayItems">
                <!-- Only show if value exists -->
                <div *ngIf="getValue(item.field)" style="display: flex; gap: 12px; align-items: flex-start;">
                  <span style="font-size: 20px;">{{ item.icon }}</span>
                  <div>
                    <span style="font-weight: 600; display: block; font-size: 14px; color: #222;">{{ item.label }}:</span>
                    <span style="font-size: 14px; color: #717171;">{{ getValue(item.field) }}</span>
                  </div>
                </div>
              </ng-container>
            </div>

            <!-- Show "Get Started" only if profile is empty -->
            <div *ngIf="!profileDetails?.aboutMe && !getValue('myWork')" style="margin-top: 20px;">
              <h4>Complete your profile</h4>
              <p>Add details to help hosts and guests get to know you.</p>
              <button (click)="onGetStarted()" class="get-started-btn">
                Get started
              </button>
            </div>

          </div>
        </div>

        <div class="reviews-section">
          <div class="reviews-icon">ðŸ’¬</div>
          <span>Reviews I've written</span>
        </div>

      } @else {
        <!-- Loading State -->
        <div class="flex items-center justify-center min-h-[80vh]">
          <div class="text-center p-16 bg-white rounded-lg shadow-md border border-gray-200">
            <h2 class="text-xl font-semibold text-gray-600 mt-4">Loading Profile...</h2>
          </div>
        </div>
      }
    </section>
  </div>
</div>