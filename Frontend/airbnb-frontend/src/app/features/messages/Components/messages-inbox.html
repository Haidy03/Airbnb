<div class="inbox-container" style="padding-top: 100px;">

  <!-- Left Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h1 class="title">Messages</h1>
      <div class="actions">
        <button class="icon-btn"><i class="bi bi-search"></i></button>
        <button class="icon-btn"><i class="bi bi-sliders"></i></button>
      </div>
    </div>

    <!-- âœ… Filters (Pills) -->
    <div class="filters">
      <button class="filter-pill"
              [class.active]="activeFilter() === 'all'"
              (click)="setFilter('all')">
        All
      </button>
      <button class="filter-pill"
              [class.active]="activeFilter() === 'unread'"
              (click)="setFilter('unread')">
        Unread
      </button>
    </div>

    <!-- Conversations List -->
    <div class="conversations-list">

      <!-- Empty State -->
      <div *ngIf="filteredConversations().length === 0" class="empty-state">
        <div class="empty-icon">ðŸ’¬</div>
        <p>You donâ€™t have any {{ activeFilter() === 'unread' ? 'unread' : '' }} messages</p>
      </div>

      <div *ngFor="let conv of filteredConversations()"
           class="conversation-card"
           [class.selected]="selectedConversation()?.id === conv.id"
           [class.unread]="conv.unreadCount > 0"
           (click)="selectConversation(conv)">

        <div class="avatar-wrapper">
          <img [src]="getOtherParticipant(conv).avatar || 'assets/images/user-placeholder.png'" alt="User">
        </div>

        <div class="card-content">
          <div class="card-top">
            <span class="user-name">{{ getOtherParticipant(conv).name }}</span>
            <span class="time">{{ conv.lastMessage?.sentAt | date:'MMM d' }}</span>
          </div>
          <div class="card-bottom">
            <p class="preview-text">
              {{ conv.lastMessage?.content || 'Start a conversation' }}
            </p>
            <span *ngIf="conv.unreadCount > 0" class="unread-dot"></span>
          </div>
          <div class="listing-tag">{{ conv.propertyTitle }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Area -->
  <div class="chat-area">
    <div *ngIf="selectedConversation(); else noSelection" class="chat-wrapper">

      <!-- Chat Header -->
      <div class="chat-header">
        <div class="header-user">
          <h2>{{ getOtherParticipant(selectedConversation()!).name }}</h2>
          <p>{{ selectedConversation()!.propertyTitle }}</p>
        </div>
      </div>

      <!-- Messages List -->
      <div class="messages-scroll" #scrollMe>
        <div *ngFor="let msg of messages()"
             class="message-row"
             [class.mine]="isMyMessage(msg)"
             [class.theirs]="!isMyMessage(msg)">

          <!-- âœ… Ø§Ù„ØµÙˆØ±Ø© ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± (Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±) -->
          <img *ngIf="!isMyMessage(msg)"
               [src]="getOtherParticipant(selectedConversation()!).avatar || 'assets/images/user-placeholder.png'"
               class="chat-avatar">

          <div class="bubble-container">
            <div class="bubble">
              {{ msg.content }}
            </div>
            <span class="msg-time">{{ msg.sentAt | date:'shortTime' }}</span>
          </div>
        </div>
      </div>

      <!-- âœ… Input Area -->
      <div class="input-area">
        <div class="input-wrapper">
          <textarea
            [(ngModel)]="newMessageText"
            placeholder="Type a message..."
            rows="1"
            (keydown.enter)="sendMessage()">
          </textarea>
          <button class="send-btn" (click)="sendMessage()" [disabled]="!newMessageText().trim() || isSending()">
            <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation" focusable="false" style="display: block; fill: none; height: 16px; width: 16px; stroke: currentcolor; stroke-width: 4; overflow: visible;"><path d="m2.6 15.9 26.2-13.3c.8-.4 1.8.1 1.8 1v24.8c0 .9-1 1.4-1.8 1l-26.2-13.3c-.7-.4-.7-1.4 0-1.8z" fill="none"></path></svg>
          </button>
        </div>
      </div>

    </div>

    <ng-template #noSelection>
      <div class="no-selection-state">
        <h3>Select a conversation</h3>
        <p>Choose a conversation from the list to view details.</p>
      </div>
    </ng-template>
  </div>
</div>
